<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastrar Quantidade</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            margin: 0;
            font-family: Arial, sans-serif;
            height: 100vh;
        }

       
        /*////////////////////////TOP SECTION/////////////////////////////////////*/

        .top-section {
  background-color: #f0f0f0;
  padding: 10px;
  overflow-x: auto;
  width: 100%;
  height: 100%;
  max-width: 1360px;
  max-height: 125px;
 
  box-sizing: border-box;
}

.linha-superior {
  display: flex;
  gap: 12px;
  margin-bottom: 4px;
  flex-wrap: wrap;
  justify-content: space-between;
  font-size: 12px;
}

.linha-inferior {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  gap: 2px;
  margin-bottom: 2px;
}

/* Estilo geral para os blocos internos */
.linha-superior > div,
.linha-inferior > div {
  display: flex;
  flex-direction: column;
  align-items: center;
  flex: 1;
  min-width: 130px;
  flex-wrap: wrap;
  
}

/* Labels */
.top-section label {
  font-weight: bold;
  margin-bottom: 4px;
  text-align: center;
  font-size: 12px;
  height: 12px;
}

/* Inputs e Selects padrão (parte inferior) */
.linha-inferior input,
.linha-inferior select {
  width: 100%;
  padding: 2px;
  height: 26px;
  text-align: center;
  border: 1px solid #ccc;
  border-radius: 4px;
  background-color: #fff;
  box-sizing: border-box;
  font-size: 12px;
}

/* Inputs e Selects da parte superior com largura total do container pai */
.linha-superior input,
.linha-superior select {
  width: 100%;
  padding: 6px;
  height: 28px;
  text-align: center;
  border: 1px solid #ccc;
  border-radius: 2px;
  background-color: #fff;
  box-sizing: border-box;
  font-size: 12px;
}




        /*////////////////////////MENU LATERAL////////////////////////////////*/

        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
            
        }


        .sidebar {
            width: 160px;
            background-color: #f4f4f4;
            padding: 8px;
            box-shadow: 1px 0 3px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            flex-shrink: 0;
            flex-wrap: wrap;
        }

        .menu-buttons {
    display: flex;
    justify-content: center;
    
}

.menu-icon {
    width: 100%;
    height: 40px;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    border: 2px solid transparent;
    border-radius: 1px;
    cursor: pointer;
    transition: all 0.2s ease-in-out;
    /*transform: scale(0.8); /* padrão: 80% */
}

/* Botão selecionado com 100% */
.menu-icon.selected {
    border: 2px solid #007bff;
    box-shadow: inset 0 0 5px #007bff;
    transform: scale(1.5);
}





        .menu-item {
            font-size: 12px;
            padding: 3px;
            margin-bottom: 3px;
            cursor: pointer;
            background-color: #eaeaea;
            border-radius: 3px;
            text-align: center;
            transition: transform 0.1s ease-in-out, background-color 0.2s;
        }

        .menu-item.active {

            transform: scale(0.90);
            /* Efeito de "apertado" */
            background-color: #EEE8AA;
            /* Cor para destacar o item ativo */

            color: #4B0082;
            font-weight: bold;
        }

        .menu-item:hover {
            background-color: #ADD8E6;
            transform: scale(0.90);
            /* Efeito de "apertado" */


        }



        /*////////////////////////GERAL/////////////////////////////////*/


        .divider {
            border-bottom: 1px solid #ddd;
            margin: 10px 0;
        }


        .main-content {
            background-image: url('imagens/controles/mosaico_5.jpg'); /* Caminho relativo à raiz do projeto */
            background-repeat: repeat;                /* Faz a imagem se repetir */
            background-size: 200px 200px;               /* Tamanho da logo */
            background-position:center;              /* Centraliza no início */
                 
                
                                  
            max-width: 1145px;
            width: 100%;
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

            #mainContent select,
            #mainContent input {
              padding: 6px;
             border: 1px solid #ccc;
             border-radius: 5px;
            }


        /*////////////////////////PRODUTOS/////////////////////////////////*/
     
        .product-row {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            /* 6 colunas iguais */
            gap: 10px;
            /* Espaço entre os itens */
            justify-content: center;
            margin-top: 0px;
        }

        .product-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            width: 180px;
            font-size: 15px;
            /* Ajusta o tamanho da fonte */
            line-height: 1.3;
            /* Diminui o espaço entre as linhas */

        }


        .product-wrapper {
            width: 170px;
            /* Mantendo o tamanho maior */
            max-height: 600px;
            height:100%;
            border: 2px solid #ddd;
            padding: 3px;
            border-radius: 8px;
            background-color: #fff;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            margin-bottom: 00px;
            padding-top:0px important!;
            /* Distância entre linhas */



        }

        .promo-banner {
            margin-bottom: 0px; /* espaço entre divs empilhadas */
            width: 90%;
            color: red;
            font-weight: bold;
            font-size: 12px;
            background: yellow;
            padding: 4px 6px;
            border-radius: 3px;
            text-align: center;
            display: inline-block;
        }


        .image-container {
            width: 100%;
            max-width: 215px;
            height: 145px;
            /* Ajuste a altura conforme necessário para cortar a parte inferior */
            overflow: hidden;
            /* Oculta o conteúdo que ultrapassar a altura */
            display: flex;
            justify-content: center;
            align-items: start;
            /* Alinha a imagem no topo do contêiner */
        }

        .product-image {
            width: 100%;
            max-width: 215px;
        }


        .old-price {
            text-decoration: line-through;
            color: red;

        }

        .discount-price {
            font-size: 18px;
            /* Aumente o tamanho conforme necessário */
            font-weight: bold;
            /* Torna o preço mais destacado */
            color: black;
            /* Opcional, para destacar o desconto */
            font-style: italic;
            /* Define o texto como itálico */
        }

        .wrapper_corte{
            font-size: 12px;
            
        }
/*/////////////////////////////////////////////DESCONTOS COM VALORES DE COMBOS ////////////////////////*/
        .desconto-container {
    display: flex;
    gap: 0px;
    margin-top: 0px;
    margin-bottom: 5px;
    justify-content: space-between;
}

.retangulo {
    padding: 3px 5px;
    font-size: 10px;
    font-weight: bold;
    color: white;
    text-align: center;
    border-radius: 3px;
    min-width: 30px;
    width: 100%;
    height: 15px;
}

.amarelo { background-color: yellow; color: black; }
.verde { background-color: green; }
.azul { background-color: blue; }


        .control-container {
            display: flex;
            justify-content: center;
            /* Centraliza os botões */
            align-items: center;
            /* Alinha verticalmente */
            gap: 5px;
            /* Adiciona espaçamento entre os elementos */
            margin-top: 0px;
            /* Ajusta o espaçamento superior */

        }

        .control-image {
            width: 25px;
            /* Ajusta o tamanho dos botões */
            height: 25px;
            cursor: pointer;
        }


        .quantity-display {
            font-size: 12px;
            /* Ajusta o tamanho da fonte */
            font-weight: bold;
            min-width: 20px;
            /* Mantém a largura mínima para evitar que o número pule */
            text-align: center;

        }


        /*/////////////////////////////////////////////MODAL ////////////////////////*/


        /* Estilo para o fundo do modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0px;
            top: 00px;
            width: 100%;
            height: 600px;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Estilo da imagem dentro do modal */
        .modal-content {
            max-width: 100%;
            max-height: 100%;
            border-radius: 10px;
        }

        /* Botão de fechar */
        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            color: white;
            font-size: 35px;
            font-weight: bold;
            cursor: pointer;
        }








        /*/////////////////////////////////////////////POLITICAS COMERCIAIS/////////////////////////*/

        .politica-container {
            display: flex;
            flex-direction: flex;
            align-items: center;
            text-align: center;
            justify-content: start;
            gap: 10px;
            padding: 10px;
        }

        .politica-row {

            /*display: inline-block;  */
            /*flex-direction: columns;*/
            width: 200px;
            justify-content: space-between;
            margin-top: 0px;
            text-align: center;
            border-bottom: 1px solid #ddd;
            background-color: #f0f0f0;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }


        .linha {
            margin-bottom: 10px;

        }

        .linha label {

            font-size: 18px;
            font-weight: 250;
            color: #555;
        }

        .linha input {
            width: 100px !important;
            padding: 10px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 6px;
            /* Bordas arredondadas nos campos de input */
            background-color: #f9f9f9;
            transition: background-color 0.2s ease;
            text-align: center;
        }


        .linha input:focus {
            background-color: #555;
            border-color: #009688;
            /*  Cor para o foco */
        }


        .button-container {
            text-align: center;
            margin-top: 5px;
            max-width: 150px;
            width:auto;
            /* Menos margem */
        }

        button {
            background: linear-gradient(135deg, #009688, #00796b);
            /* Gradiente suave */
            color: white;
            /* Mantém a fonte branca para melhor contraste */
            border: none;
            padding: 6px 12px;
            /* Um pouco mais de padding para melhorar a aparência */
            font-size: 12px;
            /* Fonte um pouco maior para melhor legibilidade */
            font-weight: bold;
            /* Deixa o texto mais destacado */
            border-radius: 5px;
            /* Cantos mais arredondados */
            cursor: pointer;
            transition: all 0.3s ease;
            width: 150px;
            /* Um pouco mais largo */
            margin: 5px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
            /* Sombra leve para profundidade */
        }

        button:hover {
            background: linear-gradient(135deg, #00796b, #005f56);
            /* Cor mais escura no hover */
            transform: translateY(-2px);
            /* Efeito de elevação no hover */
            box-shadow: 3px 3px 7px rgba(0, 0, 0, 0.3);
        }

        button:active {
            transform: translateY(1px);
            /* Dá um efeito de "pressionado" ao clicar */
            box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
        }


        /*////////////////////////////////////////////////GRADES//////////////////////////////*/
        /* Classe para esconder os itens */


        .produtos-relacionados {
            display: none;
            /* Esconde todos os produtos ao carregar */
        }



        .hidden {
            display: none !important;
            /* Força o elemento a sumir */
            visibility: hidden;
            opacity: 0;
            height: 0;
            transition: opacity 0.3s ease-in-out;
        }



        /* Estilos para o container das grades */
        .grades-container {
            display: grid;
            gap: 0px;
            /* Espaçamento entre os itens */
            margin-top: 20px;
            padding: 1px;
            background-color: #f8f8f8;

        }


        /* Estilos para os itens de grade */
        .grade-item {
            display: inline-block;
            flex-direction: columns;
            align-items: flex-start;
            gap: 1px;
            /* Espaçamento entre os elementos */
            margin-bottom: 10px;

            padding: 0px;
            border-bottom: 1px solid #ddd;
            background-color: #f8f8f8;
            border-radius: 8px;
            width: 100%;


        }




        /* Estilo para o nome da grade */
        .grade-nome {
            font-weight: bold;
            flex-grow: 1;
            /* Ocupa o espaço disponível */
            white-space: nowrap;
            /* Evita que o texto quebre */
        }

        /* Estilo para o input de valores */
        input[type="number"] {
            width: 60px;
            /* Define uma largura suficiente para 4 dígitos */
            padding: 5px;
            text-align: center;
            /* Centraliza o texto */
            font-size: 14px;
            /* Ajusta o tamanho da fonte */
            margin-left: auto
        }


        /* Estilo para o botão de alternância */
        .button.toggle-grade {
            width: 25px !important;
            /* Define uma largura fixa */
            height: 25px !important;
            /* Define uma altura fixa */
            font-size: 18px !important;
            /* Ajusta o tamanho do símbolo "+" */
            text-align: center;
            padding: 0;
            line-height: 25px;
            /* Centraliza o texto verticalmente */
            border-radius: 50%;
            /* Torna o botão arredondado */
            display: inline-block;
            flex-direction: columns;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            /* Evita que o botão encolha */
        }



        .button.toggle-grade:hover {
            background-color: #45a049;
            /* Cor de fundo verde mais escuro ao passar o mouse */
        }

        /* Estilo para a lista de produtos relacionados */
        produtos-relacionados {
            display: none;
            width: 100%;
            padding: 5px;
            border-radius: 5px;

        }



        .produtos-relacionados p:nth-child(odd) {
            background-color: #f9f9f9;
            /* Cinza claro */
        }

        .produtos-relacionados p:nth-child(even) {
            background-color: #ffffff;
            /* Branco */
        }

        .produtos-relacionados p {
            margin: 2px 0;
            /* Reduz o espaçamento vertical */
            padding: 5px;
            /* Ajusta o espaçamento interno */
            line-height: 1.2;
            /* Reduz a altura da linha */
        }



        .produtos-relacionados.show {

            display: block;
            /* Mostra os produtos quando a classe 'show' for adicionada */

        }

        .button.button-container {
            margin-top: 20px;
            padding: 10px;
            cursor: pointer;

        }

        .button.button-container:hover {
            background-color: #eaeaea;
        }

        /* Cor diferente para os inputs alterados */
        .input-alterado {
            background-color: #ffeb99 !important;
            /* Amarelo claro para destacar */
            transition: background-color 0.3s ease-in-out;
        }

        /* Estilo para a mensagem "Quantidade alterada" */
        .alteracao-msg {
            font-size: 12px;
            color: red;
            margin-left: 10px;
            font-weight: bold;
        }


        /*////////////////////////////////////////////////COMBOS_POLITICA COMERCIAIS//////////////////////////////*/
      

        .config-header {
            
    background-color: #f9f9f9;
    display: flex; /* Permite o alinhamento lado a lado */
    align-items: center; /* Centraliza verticalmente os itens */
    padding: 10px;
    gap: 10px; /* Espaçamento entre o botão e o texto */
    
    
}

.config-header button {
    flex-shrink: 0; /* Impede que o botão diminua */
}



        /* 🔹 Container principal que agrupa todos os combos */
        .combos-container {
            margin-top: 10px;
            padding: 5px;
            background-color: #f9f9f9;
            /* Fundo levemente cinza */
            border-radius: 10px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
        }

        /*///////////////////////////////////////////////////////////////////////////*/

        /* 🔹 Cada combo listado */
        .combo-item {
            display: flex;
            flex-direction: column;
            /* 🔥 Mantém os detalhes abaixo do nome */
            padding: 0px;
            border-bottom: 1px solid #ddd;
            background-color: #f8f8f8;
            border-radius: 8px;
            width: 100%;
        }

        .combo-header {
            display: flex;
            align-items: center;
            /* 🔥 Alinha o botão e o nome na mesma linha */
            gap: 10px;
            /* 🔹 Espaço entre o botão e o nome */
        }

        .toggle-combo {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #007b7f;
            color: white;
            font-size: 16px;
            border: none;
            cursor: pointer;
        }

        .combo-nome {
            font-weight: bold;
            flex: 1;
            /* 🔹 Faz o nome ocupar o máximo de espaço */
        }


        /*///////////////////////////////////////////////////////////////////////////*/
        /* 🔹 Detalhes do combo */
        .combo-detalhes {
            max-height: 0;
            /* Começa fechado */
            overflow: hidden;
            transition: max-height 0.3s ease-in-out, padding 0.3s ease-in-out;
            padding: 0;
            width: 100%;
            margin-top: 10px;
        }

        /* 🔹 Estrutura das linhas do combo */
        .combo-itens {
            display: flex;
            flex-direction: column;
            gap: 5px;
            padding: 10px;
            background-color: #fff;
            border-radius: 8px;
            align-items: left;
            /* ✅ Ajuste correto para alinhamento */
            width: 100%;
        }

        
        /* 🔹 Cabeçalho da tabela dentro do combo */
        .combo-linha.header {
            font-weight: bold;
            background: #f8f9fa;
            padding: 5px;
            display: columns;
            grid-template-columns: 100px 80px 100px;
            /* 🔥 Ajustei para tamanhos fixos */
            border-bottom: 2px solid #ddd;
            width: 100%;
            text-align: left;
            /* 🔥 Mantém alinhado à esquerda */
            gap: 10px;
        }

        /* 🔹 Cada linha do combo */
        .combo-linha {
            display: grid;
            grid-template-columns: 80px 50px 1fr;
            /* 🔥 Mantendo alinhamento fixo */
            gap: 40px;
            padding: 5px 0;
            border-bottom: 1px solid #ddd;
            text-align: left;
            /* 🔥 Mantém os valores alinhados com os títulos */

        }

        /* 🔹 Ajustes nos inputs */
        .combo-linha input {
            width: 100%;
            /* 🔥 Ocupa toda a célula da grid */
            max-width: 50px;
            /* 🔥 Mantém um tamanho adequado */
            padding: 5px;
            text-align: center;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 5px;

        }


        /* 🔹 Ajuste nos spans para manter alinhamento */
        .combo-linha span {
            display: flex;
            align-items: left;
            justify-content: left;
            left: 0px;



        }


        /* 🔹 Estilo exclusivo para o nome do produto dentro da combo-linha */
        .combo-nome-produto {
            font-weight: bold;
            /* Deixa o texto mais destacado */
            color: #333;
            /* Cor escura para melhor visibilidade */
            font-size: 16px;
            /* Ajusta o tamanho da fonte */
            text-align: left;
            /* Alinha à esquerda para manter padrão */
            padding: 0px;
            /* Pequeno espaçamento à esquerda */
            align-items: center;
            /* Garante alinhamento vertical correto */

        }




        /* 🔹 Botão de adicionar item */
        .add-item {
            display: block;
            margin-left: 10px auto;
            padding: 8px 15px;
            font-size: 14px;
            border: none;
            background-color: #007BFF;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;

        }

        /* 🔹 Efeito ao passar o mouse no botão de adicionar */
        .add-item:hover {
            background-color: #0056b3;
        }



        /*///////////////////////////////////////////////////////////////////////////*/
        /* 🔹 Botão para expandir os itens do Combo */
        .button.toggle-combo {
            width: 30px;
            height: 30px;
            font-size: 18px;
            text-align: center;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #4CAF50;
            /* Verde */
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        /* 🔹 Efeito de hover e clique para o botão toggle */
        .button.toggle-combo:hover {
            background-color: #45a049;
        }

        .button.toggle-combo:active {
            transform: scale(0.9);
        }

 /*////////////////////////////////////////////////CLIENTES_MENU//////////////////////////////*/
        .clientes-detalhes hidden {
            max-height: 0;
              overflow: hidden;
              transition: max-height 0.3s ease-in-out, padding 0.3s ease-in-out;
              padding: 0;
              width: 100%;
              margin-top: 10px;
        }    

        .clientes-detalhes {
            
              transition: max-height 0.3s ease-in-out, padding 0.3s ease-in-out;
              padding: 0;
              width: 100%;
              margin-top: 10px;
        }    

        .pedidos-linha {
            display: grid;
            font-size: 12px;
            grid-template-columns: 80px 1fr 80px 80px 80px;
            /* 🔥 Mantendo alinhamento fixo */
            gap: 40px;
            padding: 5px 0;
            border-bottom: 1px solid #ddd;
            text-align: center;
            /* 🔥 Mantém os valores alinhados com os títulos */

        }

        /*////////////////////////////////////////////////GRADES_MENU//////////////////////////////*/
        /* 🔹 Estiliza a seção da grade */
        .grade-section {
            margin-left: start;
            width: 100%;
            margin-top: 2px;
            padding: 2px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;



        }

        /* 🔹 Estiliza o título da grade */
        .grade-title {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            color: #333;
            margin-bottom: 10px;

        }

        .product-container2 {
            display: inline-block;
            align-items: center;
            justify-content: space-between;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 0px;
            background-color: #fff;
            margin-bottom: 05px;
            text-align: center;
            width: 180px;
            font-size: 15px;
            /* Ajusta o tamanho da fonte */
            line-height: 1.3;
            /* Diminui o espaço entre as linhas */
        }


        .grade-header {
            width: 100%;
            align-items: center;
            /* 🔥 Alinha o botão e o nome na mesma linha */
            gap: 10px;
            /* 🔹 Espaço entre o botão e o nome */
        }


        /*////////////////////////////////////////////////CARRINHO DE COMPRAS//////////////////////////////*/

        .menu-divider {
            margin-top: 20px;
            padding: 10px;
            font-size: 18px;
            font-weight: bold;
            background-color: #f4f4f4;
            border-left: 5px solid #333;
        }
        .titulo-carrinho {
    font-size: 24px;
    font-weight: bold;
    text-align: center;
    margin-bottom: 10px;
}

.subtitulo-categoria {
    flex-grow: 1;
    background-color:   green;
    width:100%;
    font-size: 18px;
    font-weight: bold;
    margin-top: 15px;
    text-transform: uppercase;
    border-bottom: 2px solid #ccc;
    padding-bottom: 5px;
}
.dados-cliente-carrinho {
    width: 100%;
    margin-bottom: 15px;
    font-size: 0.95rem;
}

.linha-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.linha-info p {
    flex: 1;
    text-align: center;
    margin: 5px 0;
}

.linha-info .esquerda {
    text-align: left;
}

.linha-info .direita {
    text-align: right;
}

.linha-info .centro {
    text-align: center;
}
.resumo-carrinho {
    margin: 20px 0;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 8px;
    background-image: url('imagens/controles/fundo_quatigua.jpg'); /* Caminho relativo à raiz do projeto */
            background-repeat: repeat;                /* Faz a imagem se repetir */
            background-size: 80px 80px;               /* Tamanho da logo */
            background-position:center;              /* Centraliza no início */
    font-weight: bold;
}

.resumo-carrinho .linha-superior,
.resumo-carrinho .linha-inferior {
    display: grid;
    gap: 10px;
    margin-bottom: 10px;
}

.resumo-carrinho .linha-superior {
    grid-template-columns: repeat(6, 1fr);
    text-align: center;
}

.resumo-carrinho .linha-inferior {
    grid-template-columns: repeat(4, 1fr);
    text-align: center;
}



        /*//////////////////////////////////////////MENU ESCOLHIDO COMBOS////////////////////////////*/

        .product-row-combo {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            /* colunas iguais */
            justify-content: left;
            margin-top: 0px;
            background-color: #fff;
            border: 2px solid #ddd;
            gap: 0px;
            margin-left: start;           
            width:100%;

        }

        .product-container-combo {
            display: flex;           
            width: 100%;
            /* Mantendo o tamanho maior */
            height: 100%;
            max-height: 750px;
            display: flex;
            border: 2px solid f4f4f4;
            padding: 1px;
            border-radius: 8px;
            background-color: #fff;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            align-items: left;

        }
      



        /* 🔹 Layout do Combo */
        .parent {
            display: grid;
            grid-template-columns: 1fr 180px 1fr;
            /* Mantém alinhamento com os cabeçalhos */
            grid-template-rows: 290px auto;
            gap: 0px;
            max-width: 650px;
            width: 100%;
            height: 100%;
            border: 2px solid #ddd;


        }

        /* 🔹 Imagem do Produto */
        .div1 {
            display: flex;
            justify-content: left;
            align-items: left;
            padding: 0px;
            border-right: 2px solid #ddd;
            background-color: #f7f7f7;
            max-width: 480px;
            max-height: 288px;
        }

        .image-container-combo {
            width: 100%;
            max-width: 400px;
            height: 276px;
            overflow: hidden;
            border-radius: 8px;
            border: 2px solid #ddd;
        }

        .product-image-combo {
            width: 352px;
            height: 320px;
            /* object-fit: cover;*/
            /* 🔥 Mantém proporção correta */
        }
           p {
            margin: 5px;
            padding: 0;
            }
        .product-wrapper-combo{
           /* padding: -20px;*/
            margin-top: 10px;
            height: 288px;
            font-size: 12px;
        }
        /* 🔹 Informações do Produto */
        .div2 {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: -20px;
            max-width: 180px;
            height: 288px;
            background-color: #f3f3f3;
            align-items: center;
            line-height: 1.1;
            /* Diminui o espaço entre as linhas */


        }




        /* 🔹 Itens do Combo */
        .div3 {

            grid-column: 1 / span 2;
            /* 🔥 Ocupa toda a largura */
            background-color: #f3f3f3;
            padding: 5px;
            left: 0px;
            border-top: 2px solid #ddd;






        }

        .combo-itens-list {
            display: flex;
            flex-direction: column;
            gap: 3px;

        }

        .combo-item-menu {
            display: grid;
            grid-template-columns: 25px 25px 1fr 70px 70px;
            gap: 11px;
            padding: 4px;
            background-color: #fff;
            border-radius: 5px;
            border: 1px solid #ddd;

        }

        .combo-itemlist-1 {
            text-align: center;
            font-size: 10px;
        }

        .combo-itemlist-2 {
            text-align: left;
            font-size: 9px;
        }


        .cabecalho-itemlist-1 {
            display: grid;
            grid-template-columns: 30px 30px 1fr 80px 80px;
            gap: 10px;
            padding: 5px;
            font-size: 12px;
            border-radius: 5px;
            border: 1px solid #ddd;
            text-align: center;
            color: red;
            /* Opcional, para destacar o desconto */
            font-style: italic;
            /* Define o texto como itálico */
            font-weight: bold;
            /* Torna o preço mais destacado */

        }

        .combo-itemlist-3 {
            text-align: center;

        }


        .old-price-combo {
                
            color: red;
            font-size: 18px;
        }

        .discount-price-combo {
            font-size: 22px;
            /* Aumente o tamanho conforme necessário */
            font-weight: bold;
            /* Torna o preço mais destacado */
            color: green;
            /* Opcional, para destacar o desconto */
            font-style: italic;
            /* Define o texto como itálico */

        }
  /*/////////////////////////////CONTAINER HISTORICO DE PEDIDOS///////////////////////////////////*/
  .historico-container,
  .carrinho-container {
    background-image: url('imagens/controles/quatigua_logo_12.jpg'); /* Caminho relativo à raiz do projeto */
            background-repeat: repeat;                /* Faz a imagem se repetir */
            background-size: 80px 80px;               /* Tamanho da logo */
            background-position:center;              /* Centraliza no início */
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.2);
    font-family: Arial, sans-serif;
}

.historico-container h2 {
    color: #333;
    border-bottom: 2px solid #ddd;
    padding-bottom: 5px;
    margin-bottom: 10px;
}

.historico-container p {
    margin: 5px 0;
}

.dados-contato {
    display: flex;
    gap: 15px;
    font-weight: bold;
}

.dados-contato a {
    color: #007bff;
    text-decoration: none;
}

.dados-contato a:hover {
    text-decoration: underline;
}
 /*///////////////////////////////BOTAO PDF //////////////////////*/
.btn-pdf {
    padding: 10px 15px;
    background: #28a745;
    color: white;
    border: none;
    cursor: pointer;
    font-size: 16px;
    margin-bottom: 10px;
}

.btn-pdf:hover {
    background: #218838;
}

@media print {
    .btn-pdf {
        display: none !important;
    }
}


        /*////////////////////////////////////////////////////////////////////////////////////////////////*/
    </style>
</head>

<body>
    <div class="top-section">
        <div class="linha-superior">
          <div>
            <label for="municipio">Município</label>
            <select class="linha-superior select " id="municipio"></select>
          </div>
      
          <div>
            <label for="razao_social">Razao Social</label>
            <select class="linha-superior select " id="razao_social"></select>
          </div>
      
          <div>
            <label for="ultimopedido">Ultimo Pedido</label>
            <input class="linha-superior label "  type="text" id="ultimopedido" readonly>
          </div>
      
          <div>
            <label for="regiao">Região</label>
            <select class="linha-superior select " id="regiao"></select>
          </div>
        </div>
      
        <div class="linha-inferior">
          <div>
            <label for="prazoPagto">Prazo Pagto</label>
            <select class="linha-inferior select " id="prazoPagto"></select>
          </div>
      
          <div>
            <label for="totalparcelas">Total de Parcelas</label>
            <input class="linha-inferior input" type="text" id="totalparcelas" placeholder="0" readonly>
          </div>
      
          <div>
            <label for="formapagto">Forma de Pagto</label>
            <select class="linha-inferior select " id="formapagto">
              <option value="" selected disabled>Selecione</option>
              <option value="DINHEIRO">DINHEIRO</option>
              <option value="BOLETO">BOLETO</option>
              <option value="CHEQUE">CHEQUE</option>
              <option value="PIX">PIX</option>
            </select>
          </div>
      
          <div>
            <label for="totalPecas">Total de Peças</label>
            <input class="linha-inferior input"  type="text" id="totalPecas" placeholder="0" readonly>
          </div>
      
          <div>
            <label for="totalBruto">Total Bruto</label>
            <input class="linha-inferior input"  type="text" id="totalBruto" placeholder="0,00" readonly>
          </div>
      
          <div>
            <label for="totalDesconto">Promoções</label>
            <input class="linha-inferior input"  type="text" id="totalDesconto" placeholder="R$ 0,00" readonly>
          </div>
      
          <div>
            <label for="totalCombos">Combos</label>
            <input cclass="linha-inferior input"  type="text" id="totalCombos" placeholder="0,00" readonly>
          </div>
      
          <div>
            <label for="totalGradeDesconto">Grades</label>
            <input class="linha-inferior input"  type="text" id="totalGradeDesconto" placeholder="0,00" readonly>
          </div>
      
          <div>
            <label for="totalLiquido">Total Líquido</label>
            <input class="linha-inferior input"  type="text" id="totalLiquido" placeholder="0" readonly>
          </div>
      
          <div>
            <label for="totalCashback">Total Cashback</label>
            <input class="linha-inferior input"  type="text" id="totalCashback" placeholder="0,00" readonly>
          </div>
        </div>
      </div>
      

    <div class="main-container">
        <div class="sidebar">
            <div class="menu-buttons">
                <button class="menu-icon" id="btn-quatigua" data-id="quatigua" title="Quatigua"></button>
                <button class="menu-icon" id="btn-distribuidora" data-id="distribuidora" title="Distribuidora"></button>
                <button class="menu-icon" id="btn-linha-pro" data-id="linha_pro" title="Linha Pro"></button>
            </div>
            <div class="divider"></div> 
            <div class="menu-item" onclick="showCategory('HISTORICO')">Historico</div>
            <div class="menu-item" onclick="showCategory('CARRINHO DE COMPRA')">Carrinho de Compra</div>            
            <div class="divider"></div> 
            <div class="menu-item" data-menu="LISTA GERAL" onclick="showCategory('LISTA GERAL')">Lista Geral</div>
            <div class="menu-item" data-menu="PROMOÇÃO" onclick="showCategory('PROMOÇÃO')">Promoção</div>
            <div class="menu-item" data-menu="QUEIMA ESTOQUE" onclick="showCategory('QUEIMA ESTOQUE')">Queima Estoque</div>
            <div class="menu-item" data-menu="CURVA A" onclick="showCategory('CURVA A')">Curva A</div>
            <div class="menu-item" data-menu="GRADE" onclick="showCategory('GRADE')">Grade</div>
            <div class="menu-item" data-menu="CASHBACK" onclick="showCategory('CASHBACK')">Cashback</div>

         <div id="menus-quatigua" class="menu-grupo">
            <div class="divider"></div>
            <div class="menu-item" onclick="showCategory('COMBOS')">Combos</div>
            <div class="menu-item" onclick="showCategory('PERIQUITO GAIOLAS')">Periquito Gaiolas</div>
            <div class="menu-item" onclick="showCategory('PERIQUITO CRIADEIRAS')">Periquito Criadeiras</div>
            <div class="menu-item" onclick="showCategory('LINHA BASIC')">Linha Basic</div>
            <div class="menu-item" onclick="showCategory('VIVEIROS MALHA FINA')">Viveiros Malha Fina</div>
            <div class="menu-item" onclick="showCategory('CANARIO CRIADEIRAS')">Canario Criadeiras</div>
            <div class="menu-item" onclick="showCategory('SILVESTRES')">Silvestres</div>
            <div class="menu-item" onclick="showCategory('AGAPORNIS')">Agapornis</div>
            <div class="menu-item" onclick="showCategory('CALOPSITA GAIOLAS')">Calopsita Gaiolas</div>
            <div class="menu-item" onclick="showCategory('CALOPSITA CRIADEIRAS')">Calopsita Criadeiras</div>
            <div class="menu-item" onclick="showCategory('CALOPSITA VIVEIROS')">Calopsita Viveiros</div>
            <div class="menu-item" onclick="showCategory('CALOPSITA & PAPAGAIO')">Calopsita & Papagaio</div>
            <div class="menu-item" onclick="showCategory('PAPAGAIO GAIOLAS')">Papagaio Gaiolas</div>
            <div class="menu-item" onclick="showCategory('PAPAGAIO VIVEIROS')">Papagaio Viveiros</div>
            <div class="menu-item" onclick="showCategory('ARARA')">Arara</div>
            <div class="menu-item" onclick="showCategory('HAMSTER')">Hamster</div>
            <div class="menu-item" onclick="showCategory('PORQUINHO DA INDIA')">Porquinho da India</div>
            <div class="menu-item" onclick="showCategory('TWISTER - CHINCHILA')">Twister - Chinchila</div>
            <div class="menu-item" onclick="showCategory('COELHOS')">Coelhos</div>
            <div class="menu-item" onclick="showCategory('CODORNAS')">Codornas</div>
            <div class="menu-item" onclick="showCategory('ARMADILHAS')">Armadilhas</div>
            <div class="menu-item" onclick="showCategory('CAES E GATOS')">Caes e Gatos</div>
            <div class="menu-item" onclick="showCategory('FRANGOS E PINTINHOS')">Frangos e Pintinhos</div>
            <div class="menu-item" onclick="showCategory('ACESSORIOS')">Acessorios</div>
            <div class="divider"></div>
         </div>
         <div id="menus-distribuidora" class="menu-grupo" style="display:none;">
            <div class="divider"></div> 
            <div class="menu-item" onclick="showCategory('CASINHA')">Casinha</div>
            <div class="menu-item" onclick="showCategory('TRANSPORTE')">Transporte</div>
            <div class="menu-item" onclick="showCategory('TAPETES')">Tapetes</div>
            <div class="menu-item" onclick="showCategory('HIGIENE')">Higiene</div>
            <div class="menu-item" onclick="showCategory('GATOS - BRINQUEDOS')">Gatos - Brinquedos</div>
            <div class="menu-item" onclick="showCategory('GATOS - COMEDORES')">Gatos - Comedores</div>
            <div class="menu-item" onclick="showCategory('GATOS - ARRANHADORES')">gatos - arranhadores</div>
            <div class="menu-item" onclick="showCategory('GATOS - FONTES')">Gatos - Fontes</div>
            <div class="menu-item" onclick="showCategory('CAES - CAMINHAS')">Caes - Caminhas</div>
            <div class="menu-item" onclick="showCategory('CAES - ROUPAS')">Caes - Roupas</div>
            <div class="menu-item" onclick="showCategory('CAES - COLEIRAS')">Caes - Coleiras</div>
            <div class="menu-item" onclick="showCategory('CAES - MORDEDORES')">Caes - Mordedores</div>
            <div class="menu-item" onclick="showCategory('CAES - MORDEDORES - CORDA')">Caes - Mordedores - corda</div>
            <div class="menu-item" onclick="showCategory('CAES - MORDEDORES - IMPORTADO')">Caes - Mordedores - importado</div>
            <div class="menu-item" onclick="showCategory('CAES - MORDEDORES - MACIÇOS')">Caes - Mordedores - maciços</div>
            <div class="menu-item" onclick="showCategory('CAES - MORDEDORES - VINIL')">Caes - Mordedores - vinil</div>
            <div class="menu-item" onclick="showCategory('CAES - COMEDOUROS')">Caes - Comedouros</div>
            <div class="menu-item" onclick="showCategory('ROEDORES')">Roedores</div>
            <div class="menu-item" onclick="showCategory('PASSAROS - PLASTICOS')">Passaros - Plasticos</div>
            <div class="menu-item" onclick="showCategory('PASSAROS - MADEIRA')">Passaros - Madeira</div>
            <div class="menu-item" onclick="showCategory('PASSAROS - ACESSORIOS')">Passaros - Acessorios</div>
            <div class="menu-item" onclick="showCategory('LOJA - DIVERSOS')">Loja - Diversos</div>
            <div class="menu-item" onclick="showCategory('LOJA - EXPOSITORES')">Loja - Expositores</div>
            <div class="divider"></div>
         </div>

            <div class="menu-item" onclick="showCategory('POLITICAS COMERCIAIS')">Politicas Comerciais</div>
            <div class="menu-item" onclick="showCategory('CLIENTES')">Clientes</div>
         </div>

         <div class="main-content" id="mainContent">
            <!-- Produtos serão carregados dinamicamente -->
            <h2>Selecione uma categoria no menu</h2>

        </div>

    </div>






    <script type="module">
        Promise.all([
            import(`./js/produtos.js?t=${Date.now()}`),
            import(`./js/politicas.js?t=${Date.now()}`),
            import(`./js/grade.js?t=${Date.now()}`),
            import(`./js/comboConfig.js?t=${Date.now()}`),
            import(`./js/pedidos.js?t=${Date.now()}`),
            import(`./js/clientes.js?t=${Date.now()}`),
            import(`./js/prazos.js?t=${Date.now()}`), 
        ]).then(([produtosModule, politicasModule, gradeModule, comboConfigModule, pedidosModule, clientesModule,prazosModule]) => {
            window.produtos = produtosModule.default.filter(produto => produto.ativo === "SIM");
            window.politicas = politicasModule.default;
            window.grade = gradeModule.default;
            window.comboConfig = comboConfigModule.default;
            window.pedidos = pedidosModule.default;
            window.clientes = clientesModule.default;
            window.prazos = prazosModule.default;

           

            console.log("✅ Módulos importados com sucesso!");
    
            iniciarAplicacao(); // ⚡ Agora chamamos essa função antes do DOMContentLoaded
        }).catch(error => console.error("❌ Erro ao carregar arquivos:", error));
    
        function iniciarAplicacao() {
            if (window.produtos) {
                window.produtos.forEach(p => {  
                    p["preco"] = parseFloat((p["preco"] || "0").replace(",", ".")) || 0; 
                    p["queima_%"] = parseFloat((p["queima_%"] || "0").replace(",", ".")) || 0;       
                    p["promo_%"] = parseFloat((p["promo_%"] || "0").replace(",", ".")) || 0;       
                    p["cashback_%"] = parseFloat((p["cashback_%"] || "0").replace(",", ".")) || 0;
                    p["poli_a_%"] = parseFloat((p["poli_a_%"] || "0").replace(",", ".")) || 0;
                    p["poli_b_%"] = parseFloat((p["poli_b_%"] || "0").replace(",", ".")) || 0;
                    p["poli_c_%"] = parseFloat((p["poli_c_%"] || "0").replace(",", ".")) || 0;
                    p["grade_%"] = parseFloat((p["grade_%"] || "0").replace(",", ".")) || 0;
                });
            }

            if (window.prazos) {
                window.prazos.forEach(p => {
                  p["desconto"] = parseFloat((p["desconto"] || "0").replace(",", ".")) || 0;
                });
            }

            
            
            console.log("produtos carregados1:", window.produtos);
            console.log("politicas carregados1:", window.politicas);
            console.log("grade  carregados1:", window.grade);
            console.log("comboconfigcarregados1:", window.comboConfig);
            console.log("11clientes carregados1:", window.clientes);    
               
                // ⚠️ Espera o DOM terminar de montar (botões visuais)
                    setTimeout(() => {
                    verificarMenusComDados();
                    }, 0);
           
        }
    </script>
      
      <script src="./js/jspdf.umd.min.js"></script>
      <script src="./js/html2canvas.min.js"></script>

<!-- Segundo script: código normal -->

<script>

///////////////////////////CARREGA MENUS PROMOCIONAIS////////////////
function verificarMenusComDados() {
    if (!window.produtos || !Array.isArray(window.produtos)) {
        console.warn("⏳ Produtos ainda não estão carregados.");
        return;
    }

    const menus = {
        "PROMOÇÃO": produto => parseFloat(produto["promo_%"]) > 0,
        "CURVA A": produto => produto["curva_a"] === "SIM",
        "GRADE": produto => parseFloat(produto["grade_%"]) > 0,
        "CASHBACK": produto => parseFloat(produto["cashback_%"]) > 0,
        "QUEIMA ESTOQUE": produto => parseFloat(produto["queima_%"]) > 0,
    };

    const empresaSelecionada = (window.empresaSelecionada || "").toUpperCase();
    const produtosFiltrados = window.produtos.filter(produto => 
        (produto.empresa || "").toUpperCase() === empresaSelecionada
    );

    Object.keys(menus).forEach(menu => {
        const temItens = produtosFiltrados.some(menus[menu]);
        const el = document.querySelector(`.menu-item[data-menu="${menu}"]`);
        if (el) {
            el.style.display = temItens ? "block" : "none";
            console.log(`📌 Menu "${menu}" ${temItens ? "visível ✅" : "ocultado ❌"}`);
        }
    });
}


   /////////BOTOES COM LOGO NO MENU/////////////
   // Aplica as imagens aos botões (com .jpg agora corretamente)
document.getElementById("btn-quatigua").style.backgroundImage = "url('./imagens/controles/quatigua_logo.jpg')";
document.getElementById("btn-distribuidora").style.backgroundImage = "url('./imagens/controles/distribuidora_logo.jpg')";
document.getElementById("btn-linha-pro").style.backgroundImage = "url('./imagens/controles/linha_pro_logo.jpg')";

// 🟡 Define variável global com empresa inicial (quatigua)
window.empresaSelecionada = "quatigua";

// 🟡 Função principal para tratar clique no botão de empresa
function selecionarEmpresa(btn) {
    // Remove seleção de todos os botões
    document.querySelectorAll(".menu-icon").forEach(b => {
        b.classList.remove("selected");
        b.style.transform = "scale(0.8)";
    });

    // Marca o botão clicado
    btn.classList.add("selected");
    btn.style.transform = "scale(1.5)";

    // Define empresa global
    const idSelecionado = btn.dataset.id;
    window.empresaSelecionada = idSelecionado;
    verificarMenusComDados(); 
    console.log("🔰 Empresa selecionada:", idSelecionado);

    // Mostra apenas o grupo de menus correspondente
    document.querySelectorAll(".menu-grupo").forEach(grupo => grupo.style.display = "none");
    const grupoParaMostrar = document.getElementById(`menus-${idSelecionado}`);
    if (grupoParaMostrar) grupoParaMostrar.style.display = "block";
    

    // ✅ Aguarda produtos estarem carregados antes de chamar
    if (Array.isArray(window.produtos) && window.produtos.length > 0) {
        showCategory("CARRINHO DE COMPRA");
    } else {
        console.warn("⚠️ Produtos ainda não carregados. showCategory ignorado.");
    }
}


// 🟡 Adiciona evento a todos os botões de empresa
document.querySelectorAll(".menu-icon").forEach(btn => {
    btn.addEventListener("click", () => selecionarEmpresa(btn));
});

// 🟡 Executa a seleção inicial automaticamente no botão "quatigua"
const botaoInicial = document.querySelector('.menu-icon[data-id="quatigua"]');
if (botaoInicial) selecionarEmpresa(botaoInicial);

////////////////////////////////////////////////////////////////////////////////////////////

  ////inicio nova função historico html - funcionando bem///

  function adicionarBotoesExportacao(mainContent, opcoes = { html: true, pdf: true }) {
    // Verifica se os botões já foram adicionados
    if (mainContent.querySelector(".buttonContainer")) return;

    // Cria um contêiner para os botões
    const buttonContainer = document.createElement("div");
    buttonContainer.className = "buttonContainer";
    buttonContainer.style.display = "flex";
    buttonContainer.style.gap = "20px";
    buttonContainer.style.marginBottom = "10px";

    // Botão HTML
    if (opcoes.html) {
        const botaoHTML = document.createElement("button");
        botaoHTML.textContent = "Gerar HTML";
        botaoHTML.className = "button-container";
        botaoHTML.onclick = imprimehtm;
        buttonContainer.appendChild(botaoHTML);
    }

    // Botão PDF
    if (opcoes.pdf) {
        const botaoPDF = document.createElement("button");
        botaoPDF.textContent = "Gerar PDF";
        botaoPDF.className = "button-container";
        botaoPDF.onclick = imprimepdf;
        buttonContainer.appendChild(botaoPDF);
    }

    // Adiciona ao topo
    mainContent.prepend(buttonContainer);
}
async function imprimehtm() {
    
    // 🟡 Captura o menu ativo
    const menuAtivo = document.querySelector('.menu-item.active');
    const menuSelecionado = menuAtivo ? menuAtivo.textContent.trim() : "Desconhecido";
    console.log("📌 Menu selecionado detectado:", menuSelecionado);

    // Clona o conteúdo inteiro da página
    let clone = document.documentElement.cloneNode(true);

    // Remove os elementos indesejados conforme menu
    if (menuSelecionado === "Carrinho de Compra") {
    clone.querySelectorAll(".top-section, .sidebar, .menu-item, .buttonContainer").forEach(el => el.remove());
    } else {
    clone.querySelectorAll(".top-section, .sidebar, .menu-item, .buttonContainer, .wrapper_corte").forEach(el => el.remove());
    }
   
    const mainContentClonado = clone.querySelector("#mainContent");

    if (mainContentClonado) {   
    mainContentClonado.style.backgroundImage = "url('imagens//controles/mosaico_5.jpg')";
    mainContentClonado.style.backgroundRepeat = "repeat";
    mainContentClonado.style.backgroundSize = "200px 200px";
    mainContentClonado.style.backgroundPosition = "center";
    }
 

    await aguardarImagensCarregarem(clone);
    await converterImagensParaBase64(clone);

    // ✅ Obtém a razão social
    const razao = obterRazaoSocial(); // Essa função já deve existir

    // 📝 Define nome do arquivo
    let nomeArquivo = "";
    if (menuSelecionado === "Historico") {
        nomeArquivo = `Consumo de ${razao}.html`;
    } else if (menuSelecionado === "Carrinho de Compra") {
        nomeArquivo = `Orcamento de ${razao}.html`;
    } else {
        nomeArquivo = `Lista de Produtos ${menuSelecionado}.html`;
    }

   
    
    // Cria o conteúdo extra para o topo da página (logo + título), se necessário
    let cabecalhoExtra = "";
    
    if (menuSelecionado !== "Histórico" && menuSelecionado !== "Carrinho de Compra") {
    cabecalhoExtra = `
    <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
        <h2 style="margin: 0; font-family: sans-serif;">Lista de Produtos: ${menuSelecionado}</h2>
        </div>
    `;
    }

    console.log("✅ Clonado contém:", clone.querySelector("#mainContent"));

    // Converte o conteúdo para uma string HTML completa
    const htmlContent = `
        <!DOCTYPE html>
        <html>
            <head>                
               <title>${menuSelecionado}</title>
            </head>
              ${cabecalhoExtra}
              ${clone.innerHTML}
        </html>
    `;

    // Cria um Blob com tipo .html
    const blob = new Blob([htmlContent], { type: "text/html" });

    // Cria uma URL para o Blob
    const url = URL.createObjectURL(blob);

    // Cria um link para download
    const a = document.createElement("a");
    a.href = url;
    a.download = nomeArquivo;
    document.body.appendChild(a);
    a.click();

    // Limpa
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}




async function aguardarImagensCarregarem(clone) {
    const imagens = clone.querySelectorAll("img");
    const promessas = Array.from(imagens).map(img => {
        return new Promise(resolve => {
            if (img.complete) {
                resolve();
            } else {
                img.onload = () => resolve();
                img.onerror = () => resolve(); // ignora erro mas continua o processo
            }
        });
    });
    await Promise.all(promessas);
}
async function converterImagensParaBase64(clone) {
    const imagens = clone.querySelectorAll("img");

    for (let img of imagens) {
        const src = img.src;

        if (src.startsWith("data:image")) continue; // já está em base64

        try {
            const resposta = await fetch(src);
            const blob = await resposta.blob();

            const base64 = await new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(blob);
            });

            img.src = base64; // ✅ Aqui a troca realmente acontece
        } catch (erro) {
            console.warn("Erro ao converter imagem:", src, erro);
        }
    }
}
function obterRazaoSocial() {
    let razaoSocial = "SemNome";

    // 1️⃣ Tenta encontrar na .historico-container e pegar apenas a Razão Social
    let historico = document.querySelector(".historico-container strong");
    if (historico && historico.textContent.includes("Razão Social")) {
        let texto = historico.parentElement?.textContent || "";
        razaoSocial = texto.replace("Razão Social", "").split("-")[0].trim(); // Remove a cidade (supondo que esteja após "-")
    }

    // 2️⃣ Se não encontrar, tenta pegar a opção selecionada no <select>
    if (!razaoSocial || razaoSocial === "SemNome") {
        let select = document.querySelector("#razao_social");
        let opcaoSelecionada = select?.options[select.selectedIndex]?.text;
        if (opcaoSelecionada) {
            razaoSocial = opcaoSelecionada.split("-")[0].trim(); // Remove a cidade
        }
    }

    return razaoSocial || "SemNome";
}


////final nova função historico html - funcionando bem///
    





////////////////////////////BOTOES E FUNÇÕES PARA SLVAR PAGINAS HTML E PDF
async function imprimepdf() {

    const menuAtivo = document.querySelector('.menu-item.active');
    const menuSelecionado = menuAtivo ? menuAtivo.textContent.trim() : "Desconhecido";
    console.log("📌 Menu selecionado detectado:", menuSelecionado);

    // Clona todo o documento
    let clone = document.documentElement.cloneNode(true);

    // Remove os elementos indesejados conforme menu
    if (menuSelecionado === "Carrinho de Compra") {
    clone.querySelectorAll(".top-section, .sidebar, .menu-item, .buttonContainer").forEach(el => el.remove());
    } else {
    clone.querySelectorAll(".top-section, .sidebar, .menu-item, .buttonContainer, .wrapper_corte").forEach(el => el.remove());
    }

    // 1. Localiza o elemento principal clonado
    const mainClonado = clone.querySelector("#mainContent");

// 2. Cria o elemento de cabeçalho
    if (menuSelecionado !== "Histórico" && menuSelecionado !== "Carrinho de Compra" && mainClonado) {
    const cabecalhoDiv = document.createElement("div");
    cabecalhoDiv.innerHTML = `
        <div style="
            border: 1px solid #ccc; 
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2); 
            padding: 10px 20px; 
            /*background-color: #f9f9f9;*/
            margin-bottom: 20px;
            border-radius: 16px;
            display: flex; 
            align-items: center; 
            gap: 20px;
            
        ">
            
            <h2 style=
            "margin: 0;
             border-radius: 3px;
             text-align: center;
             font-size: 24px; 
             background-color: #eaeaea;
             font-family: Helvetica;*/
             ">Lista de Produtos: ${menuSelecionado}</h2>
        </div>
    `;
    
    // 3. Insere no topo do mainContent clonado
    mainClonado.prepend(cabecalhoDiv);
}
    // Converte imagens para Base64, reduzindo tamanho
    await converterImagensParaBase64(clone);
    
    // ✅ Obtém a razão social
    const razao = obterRazaoSocial(); // Essa função já deve existir

    // 📝 Define nome do arquivo
    let nomeArquivo = "";
    if (menuSelecionado === "Historico") {
        nomeArquivo = `Consumo de ${razao}.pdf`;
    } else if (menuSelecionado === "Carrinho de Compra") {
        nomeArquivo = `Orcamento de ${razao}.pdf`;
    } else {
        nomeArquivo = `Lista de Produtos ${menuSelecionado}.pdf`;
    }

     
    // Abre uma nova aba
    let novaAba = window.open();

    // Aguarda a nova aba carregar e insere o conteúdo
    novaAba.document.open();
    novaAba.document.write(clone.outerHTML);
    novaAba.document.title = menuSelecionado; 
    

    // Chama a função para salvar automaticamente
 
   salvarPaginanovaAbapdf(novaAba, nomeArquivo);
    
}



async function antigo_imprimepdf() {
    // Clona todo o documento
    let clone = document.documentElement.cloneNode(true);

    // Remove os elementos indesejados
    clone.querySelectorAll(".top-section, .sidebar, .menu-item, .btn-pdf ").forEach(el => el.remove());

    // Converte imagens para Base64, reduzindo tamanho
    await converterImagensParaBase64(clone);

    // Abre uma nova aba
    let novaAba = window.open();

    // Aguarda a nova aba carregar e insere o conteúdo
    novaAba.document.open();
    novaAba.document.write(clone.outerHTML);

    // Atualiza o <title> da nova aba
    novaAba.document.title = "Carrinho de Compras";

    // Obtém o nome correto da Razão Social
   
    let nomeArquivo = `Orçamento de ${obterRazaoSocial()}.pdf`;

    // Chama a função para salvar automaticamente
 
   salvarPaginanovaAbapdf(novaAba, nomeArquivo);
    
}
async function salvarPaginanovaAbapdf(novaAba, nomeArquivo) {
    const jsPDF = window.jspdf.jsPDF;

    console.log("📥 Iniciando captura do conteúdo da nova aba...");

    const mainContent = novaAba.document.querySelector("#mainContent");

    if (!mainContent) {
        console.error("❌ Elemento #mainContent não encontrado na nova aba.");
        return;
    }

    console.log("✅ Elemento #mainContent encontrado:", mainContent);
    console.log("🖼️ Total de imagens encontradas:", mainContent.querySelectorAll("img").length);

    // Reduz temporariamente o zoom do conteúdo para caber no A4
    mainContent.style.transform = "scale(0.72)";
    mainContent.style.transformOrigin = "top left";
    mainContent.style.width = "210mm";
    mainContent.style.padding = "0";

    console.log("🔧 Estilos aplicados para ajuste A4.");

    // Aguarda renderização visual
    await new Promise(resolve => setTimeout(resolve, 1500));
    console.log("⏳ Espera de 1.5s concluída. Iniciando captura com html2canvas...");

    html2canvas(mainContent, {
        scale: 2,
        useCORS: true,
        windowWidth: mainContent.scrollWidth,
        windowHeight: mainContent.scrollHeight
    }).then(canvas => {
        console.log("✅ Canvas capturado com sucesso.");

        const imgData = canvas.toDataURL("image/png");
       

        const pdfWidth = 210;
        const imgProps = {
            width: canvas.width,
            height: canvas.height
        };

        const customHeight = (imgProps.height * pdfWidth) / imgProps.width;
        console.log("📏 Dimensões calculadas -> largura:", pdfWidth, "altura:", customHeight);

        const pdf = new jsPDF({
            orientation: "portrait",
            unit: "mm",
            format: [pdfWidth, customHeight]
        });

        console.log("📝 PDF criado. Inserindo imagem...");
        pdf.addImage(imgData, "PNG", 0, 0, pdfWidth, customHeight);

        console.log("💾 Salvando PDF como:", nomeArquivo);
        pdf.save(nomeArquivo);

        console.log("🎉 PDF gerado com sucesso!");
    }).catch(err => {
        console.error("❌ Erro ao gerar canvas com html2canvas:", err);
    });
}



/////////////////////////////////////////PREENCHER INPUTS///////////////

////////////////////////////////////////////////////

function preencherOpcoesRegiao() {
    const selectRegiao = document.getElementById('regiao');
    const estadosSet = new Set();

    // Mensagem 1: window.clientes está carregado?
    if (!window.clientes || !Array.isArray(window.clientes)) {
        console.warn("⚠️ window.clientes não está carregado ou não é um array!");
        return;
    } else {
        console.log("✅ window.clientes carregado corretamente.");
    }

    // Mensagem 2: quantos valores para 'cidade' existem
    const cidadesComValor = window.clientes.filter(cliente => cliente.cidade);
    console.log(`📍 Total de cidades com valor definido: ${cidadesComValor.length}`);

    // Processa os estados únicos
    cidadesComValor.forEach(cliente => {
        const cidade = cliente.cidade;
        const estado = cidade.slice(-2).toUpperCase();
        if (!estadosSet.has(estado)) {
            console.log(`🧩 Novo estado detectado: ${estado}`);
            estadosSet.add(estado);
        }
    });

    // Limpa o select e adiciona a opção padrão
    selectRegiao.innerHTML = `<option value="">Selecione</option>`;

    // Mensagem 3: estados únicos encontrados
    const estadosUnicos = Array.from(estadosSet).sort();
    console.log(`✅ Estados únicos detectados: ${estadosUnicos.join(", ")}`);

    estadosUnicos.forEach(estado => {
        const option = document.createElement('option');
        option.value = estado;
        option.textContent = estado;
        selectRegiao.appendChild(option);
    });
}

// Chama ao carregar a página
document.addEventListener('DOMContentLoaded', preencherOpcoesRegiao);
        
function carregarMunicipios() {
    const selectMunicipio = document.getElementById("municipio");
    const selectRazaoSocial = document.getElementById("razao_social");
    const inputUltimoPedido = document.getElementById("ultimopedido");
    const selectRegiao = document.getElementById("regiao"); // Referência ao campo Região

    let cnpjSelecionado = "";
    

    const verificarDados = setInterval(() => {
        if (window.pedidos && Array.isArray(window.pedidos) && window.clientes && Array.isArray(window.clientes)) {
            clearInterval(verificarDados);

            const clientesValidos = window.clientes.filter(cliente => cliente.setor !== "EXCLUIDOS");
            const municipiosUnicos = [...new Set(window.clientes.map(c => c.cidade))].sort();

            selectMunicipio.innerHTML = `<option value="">Selecione um município</option>` +
                municipiosUnicos.map(mun => `<option value="${mun}">${mun}</option>`).join('');

            selectMunicipio.addEventListener("change", () => {
                const municipioSelecionado = selectMunicipio.value;
                preencherOpcoesRegiao();

                // 🔹 Identifica a região (SP ou MG) pegando os dois últimos caracteres do nome da cidade
                const estadoDetectado = municipioSelecionado.slice(-2).toUpperCase();
                selectRegiao.value = estadoDetectado; // Atualiza automaticamente o campo Região

                console.log(`📌 Região detectada: ${estadoDetectado}`);

                // 🔹 Aplica o reajuste de preços conforme a região
                ajustarPrecosPorRegiao(estadoDetectado);

                // 🔹 Filtra clientes pela cidade
                const clientesFiltrados = clientesValidos
                    .filter(cliente => cliente.cidade === municipioSelecionado)
                    .map(cliente => ({ razao_social: cliente.razao_social, cnpj: cliente.cnpj }));

                const clientesUnicos = [...new Map(clientesFiltrados.map(c => [c.razao_social, c])).values()]
                    .sort((a, b) => a.razao_social.localeCompare(b.razao_social));

                selectRazaoSocial.innerHTML = clientesUnicos.length > 0
                    ? `<option value="">Selecione um Cliente</option>` +
                      clientesUnicos.map(cliente =>
                        `<option value="${cliente.cnpj}">${cliente.razao_social}</option>`
                    ).join('')
                    : `<option value="">Nenhum cliente encontrado</option>`;

                inputUltimoPedido.value = "";
            });

            selectRazaoSocial.addEventListener("change", () => {
    // Atualiza a Razão Social selecionada
    razaoSocialSelecionada = selectRazaoSocial.value; 
    console.log("🟢 Razão Social selecionada:", razaoSocialSelecionada);

    // Atualiza a data do último pedido
    if (razaoSocialSelecionada) {
        const datasPedidos = window.pedidos
            .filter(pedido => pedido.cnpj === razaoSocialSelecionada && pedido.data)
            .map(pedido => new Date(pedido.data.split("/").reverse().join("-")));

        if (datasPedidos.length > 0) {
            const ultimaData = new Date(Math.max(...datasPedidos));
            inputUltimoPedido.value = ultimaData.toLocaleDateString("pt-BR");
        } else {
            inputUltimoPedido.value = "Sem pedidos";
        }
    } else {
        inputUltimoPedido.value = "";
    }

    // 🏠 Atualiza o histórico automaticamente ao selecionar um cliente
    const mainContent = document.getElementById("main-content");
    if (mainContent) {
        renderizarHistorico(mainContent);
    }

    // 🧩 Atualiza a área de dados do carrinho se existir
    const cliente = window.clientes.find(c => c.cnpj === razaoSocialSelecionada);
    if (cliente) {
        const el = (id) => document.getElementById(id);

        if (el("info-razao")) el("info-razao").textContent = cliente.razao_social || '';
        if (el("info-cidade")) el("info-cidade").textContent = cliente.cidade || '';
        if (el("info-contato")) el("info-contato").textContent = cliente.contato || '';

        const whats = cliente.whats?.replace(/\D/g, '');
        if (el("info-whats")) {
            el("info-whats").innerHTML = whats 
                ? `<a href="https://wa.me/${whats}" target="_blank">Enviar Mensagem</a>` 
                : 'Não informado';
        }

        if (el("info-gps")) {
            el("info-gps").innerHTML = cliente.gps 
                ? `<a href="https://www.google.com/maps?q=${cliente.gps}" target="_blank">Abrir no Google Maps</a>` 
                : 'Não disponível';
        }
    }
});

            
        }
    }, 500);
}

// 🛠 Função para ajustar os preços conforme a região automaticamente
function ajustarPrecosPorRegiao(regiao) {
    console.log("📌 Região alterada, recalculando preços...");

    window.produtos.forEach(p => {
        let precoOriginal = parseFloat(p.precoOriginal) || parseFloat(p.preco) || 0; 

        // ✅ Sempre manter o preço original salvo para evitar acúmulo de reajustes
        if (!p.precoOriginal) p.precoOriginal = precoOriginal; 

        if (regiao === "MG") {
            p.preco = (p.precoOriginal * 1.07).toFixed(2);
        } else {
            p.preco = p.precoOriginal;
        }
    });

    console.log("✅ Preços atualizados:", window.produtos);

    // 🔹 Atualiza a interface chamando a função de exibição de produtos
    showCategory(window.menuSelecionado || "CARRINHO DE COMPRA");
}

// 🚀 Executar ao carregar a página
document.addEventListener("DOMContentLoaded", carregarMunicipios);

function criarBlocoDadosCliente(clienteSelecionado) {
    const dataAtual = new Date().toLocaleDateString('pt-BR');

    const whatsLink = clienteSelecionado.whats
        ? `<a href="https://wa.me/${clienteSelecionado.whats.replace(/\D/g, '')}" target="_blank">Enviar Mensagem</a>`
        : "Não informado";

    const gpsLink = clienteSelecionado.gps
        ? `<a href="https://www.google.com/maps?q=${clienteSelecionado.gps}" target="_blank">Abrir no Google Maps</a>`
        : "Não disponível";

    return `
        <div class="dados-cliente-carrinho">
            <div class="linha-info">
                <p class="esquerda"><strong>Data:</strong> ${dataAtual}</p>
                <p class="centro"><strong>Razão Social:</strong> ${clienteSelecionado.razao_social || ""}</p>
                <p class="direita"><strong>Cidade:</strong> ${clienteSelecionado.cidade || ""}</p>
            </div>
            <div class="linha-info">
                <p class="esquerda"><strong>Contato:</strong> ${clienteSelecionado.contato || "Não informado"}</p>
                <p class="centro"><strong>WhatsApp:</strong> ${whatsLink}</p>
                <p class="direita"><strong>GPS:</strong> ${gpsLink}</p>
            </div>
            <hr>
        </div>
    `;
}


////////////////////////////////////////////INICIO////////////////////////////




        let quantities = {};
        
        document.addEventListener("DOMContentLoaded", () => {
            console.log("✅ DOM carregado!");
    
            // Aguarda os módulos serem carregados antes de usar `window.produtos`
            const checkDataInterval = setInterval(() => {
                if (window.produtos) {
                    console.log("✅ Dados carregados no DOM:", window.produtos);
                    
                    window.produtos.forEach(produto => {
                        const codigo = produto.codigo;
                        if (!quantities[codigo]) {
                            quantities[codigo] = { quantidade: 0, total: 0 };
                        }
                    });
    
                    clearInterval(checkDataInterval); // Para a verificação após sucesso
    
                    // Aguarde um pequeno tempo para garantir que o DOM está atualizado
                    setTimeout(() => {
                          
                        showCategory('CARRINHO DE COMPRA');
                    }, 100);
                }
            }, 50); // Verifica a cada 50ms até os dados estarem disponíveis
        });
    
    
        function showCategory(menu) {
           
    const mainContent = document.getElementById('mainContent');
    mainContent.innerHTML = ''; // Limpar conteúdo anterior
    mainContent.scrollTo(0, 0);

    // Remover 'active' de todos os menus e adicionar ao menu selecionado
    document.querySelectorAll('.menu-item').forEach(item => {
        
        item.classList.remove('active');
        let itemText = item.textContent.trim().toLowerCase();
        let menuText = menu.trim().toLowerCase();
        if (itemText === menuText) {
            item.classList.add('active');
        }
    });

    let filteredProducts = window.produtos.filter(produto => produto.menu === menu);
    
    if (menu === "LISTA GERAL") {
    renderizarListaGeral(); // Função que vamos criar
    return;
}    else if (menu === "CURVA A") {
    filteredProducts = window.produtos.filter(produto => 
        produto["curva_a"] === "SIM" &&
        produto.empresa.toLowerCase() === (window.empresaSelecionada || "").toLowerCase()
    );
    
} else if (menu === "PROMOÇÃO") {
    filteredProducts = window.produtos.filter(produto => 
        parseFloat(produto["promo_%"]) > 0 &&
        produto.empresa.toLowerCase() === (window.empresaSelecionada || "").toLowerCase()
    );
} else if (menu === "QUEIMA ESTOQUE") {
    filteredProducts = window.produtos.filter(produto => 
        parseFloat(produto["queima_%"]) > 0 &&
        produto.empresa.toLowerCase() === (window.empresaSelecionada || "").toLowerCase()
    );
} else if (menu === "CASHBACK") {
    filteredProducts = window.produtos.filter(produto => 
        parseFloat(produto["cashback_%"]) > 0 &&
        produto.empresa.toLowerCase() === (window.empresaSelecionada || "").toLowerCase()
    );
                    } else if (menu === "GRADE") {
                    return renderizarGrade(mainContent); // Para "GRADE", finaliza a função
                    } else if (menu === "CARRINHO DE COMPRA") {
                        filteredProducts = window.produtos.filter(produto => quantities[produto.codigo]?.quantidade > 0);
                    } else if (menu === "HISTORICO") {
                     return renderizarHistorico(mainContent); // 🔥 Evita execução extra
                    } 

// Se o menu não for nenhum dos especiais, renderiza os produtos normalmente:
filteredProducts.sort((a, b) => a.ordem_menu - b.ordem_menu);
renderizarProdutosPorordem_menu(filteredProducts, mainContent, menu);

            
            ///////////////////////////////////// MENU POLÍTICAS COMERCIAIS ///////////////////////////////
            if (menu === "POLITICAS COMERCIAIS") {
        console.log("🔍 Carregando menu Políticas Comerciais...");
        
        // Verificar se os dados foram carregados
        if (!window.politicas) {
            console.error("❌ ERRO: window.politicas não foi carregado!");
            return;
        }

        carregarConfiguracaoPoliticas();
        carregarConfiguracaoDeCombos();
        carregarConfiguracaoDeGrades();
    }
 
  ///////////////////////////////////// MENU CLIENTES ///////////////////////////////
  if (menu === "CLIENTES") {
        console.log("🔍 Carregando menu Clientes...");
        
        // Verificar se os dados foram carregados
        if (!window.pedidos) {
            console.error("❌ ERRO: window.pedidos não foi carregado!");
            return;
        }

        carregarConfiguracaoPedidos();
       
    }

}     
 ///////////////////////////////MENU LISTA GERAL/////////////////////////////
 function renderizarListaGeral() {
    const mainContent = document.getElementById("mainContent");
    mainContent.innerHTML = ""; // Limpa o conteúdo atual

    // 🔍 Filtros no topo
    const filtros = document.createElement("div");
    filtros.style.display = "flex";
    filtros.style.gap = "10px";
    filtros.style.marginBottom = "15px";

    const inputPesquisa = document.createElement("input");
    inputPesquisa.placeholder = "Pesquisar por nome ou código base...";
    inputPesquisa.style.flex = "1";

    const selectOrdenar = document.createElement("select");
    selectOrdenar.innerHTML = `
        <option value="">Ordenar por</option>
        <option value="nome">Nome (A-Z)</option>
        <option value="preco">Preço (menor primeiro)</option>
    `;

    filtros.appendChild(inputPesquisa);
    filtros.appendChild(selectOrdenar);
    mainContent.appendChild(filtros);

    // 🔁 Função para atualizar a listagem
    function atualizarLista() {
        // Filtra e ordena os produtos
        let produtosFiltrados = window.produtos.filter(p =>
            p.empresa.toLowerCase() === window.empresaSelecionada &&
            (
                p.nome.toLowerCase().includes(inputPesquisa.value.toLowerCase()) ||
                p.cod_base.toLowerCase().includes(inputPesquisa.value.toLowerCase())
            )
        );

        if (selectOrdenar.value === "nome") {
            produtosFiltrados.sort((a, b) => a.nome.localeCompare(b.nome));
        } else if (selectOrdenar.value === "preco") {
            produtosFiltrados.sort((a, b) => a.preco - b.preco);
        }

        // Agrupa por ordem_menu
        const groupedProducts = groupBy(produtosFiltrados, 'ordem_menu');

        // Limpa e renderiza
        mainContent.querySelectorAll('.product-row, .product-row-combo').forEach(el => el.remove());

        for (const ordem_menu in groupedProducts) {
            const isCombo = groupedProducts[ordem_menu].some(p => p.menu === "COMBOS");

            const row = document.createElement('div');
            row.className = isCombo ? 'product-row-combo' : 'product-row';

            groupedProducts[ordem_menu].forEach(produto => {
                if (produto.menu === "COMBOS") {
                    row.innerHTML += createProductHTMLCombo(produto, "product-container-combo");
                } else {
                    row.innerHTML += createProductHTML(produto, "product-container");
                }
            });

            mainContent.appendChild(row);
        }

        adicionarBotoesExportacao(mainContent); // ⬅️ adiciona botões no final
    }

    // Eventos
    inputPesquisa.addEventListener("input", atualizarLista);
    selectOrdenar.addEventListener("change", atualizarLista);

    atualizarLista(); // Exibe inicialmente
}


    /////////////////////////////// CARRINHO DE HISTÓRICO DE CONSUMO //////////////////////

    function renderizarHistorico(mainContent) {
    if (!razaoSocialSelecionada) {
        mainContent.innerHTML = `<h2>Histórico de Compras</h2><p>Selecione uma Razão Social para visualizar o histórico.</p>`;
        return;
    }

    console.log("🔍 Filtrando pedidos para:", razaoSocialSelecionada);

    // 📌 Buscar os dados do cliente
    let clienteSelecionado = window.clientes.find(cliente => cliente.cnpj === razaoSocialSelecionada);

    if (!clienteSelecionado) {
        mainContent.innerHTML = `<h2>Histórico de Compras</h2><p>Cliente não encontrado.</p>`;
        return;
    }

    // 🛒 Filtra pedidos do cliente escolhido
    let pedidosCliente = window.pedidos.filter(pedido => pedido.cnpj === razaoSocialSelecionada);

    // 🔄 Remove produtos repetidos mantendo apenas um de cada código
    let produtosNoHistorico = [];
    let codigosAdicionados = new Set();

    pedidosCliente.forEach(pedido => {
        if (!codigosAdicionados.has(pedido.codigo_pro)) {
            let produtoRelacionado = window.produtos.find(prod => prod.codigo === pedido.codigo_pro);
            if (produtoRelacionado) {
                produtosNoHistorico.push(produtoRelacionado);
                codigosAdicionados.add(pedido.codigo_pro);
            }
        }
    });

    // 🏪 Organiza produtos por menu
    let produtosPorMenu = {};
    produtosNoHistorico.forEach(produto => {
        const categoria = produto.menu || "Outros";
        if (!produtosPorMenu[categoria]) {
            produtosPorMenu[categoria] = [];
        }
        produtosPorMenu[categoria].push(produto);
    });

    
    // 🎨 Estrutura HTML com estilização
    mainContent.innerHTML = `
    <div class="historico-container">
        <h2>Histórico de Compras</h2>
        ${criarBlocoDadosCliente(clienteSelecionado)}
        <h3>Produtos comprados</h3>
        </div>
        `;
            

    if (produtosNoHistorico.length === 0) {
        mainContent.innerHTML += `<p>Nenhum produto encontrado para este cliente.</p>`;
        return;
    }

    Object.keys(produtosPorMenu).forEach(menu => {
    const gradeContainer = document.createElement("div");
    gradeContainer.className = "grade-section";

    gradeContainer.innerHTML = `<h3 class="menu-divider">${menu}</h3>`;

    produtosPorMenu[menu].forEach(produto => {
        gradeContainer.innerHTML += createProductHTML(produto, "product-container2");
    });

    // Remove os elementos .wrapper_corte dentro desse gradeContainer
    setTimeout(() => {
        gradeContainer.querySelectorAll('.wrapper_corte').forEach(el => el.remove());
    }, 0);

    mainContent.appendChild(gradeContainer);
});
  
    atualizarCombos();

    // Cria um contêiner para os botões com layout em linha
    adicionarBotoesExportacao(mainContent);
}



            ///////////////////////////////MENU GRADE//////////////////////

            function renderizarGrade(mainContent) {
                let produtosPorGrade = {};

                window.produtos.filter(produto => produto.grade && parseFloat(produto["grade_%"]) > 0)
                    .forEach(produto => {
                        const grade = produto.grade.trim();
                        if (!produtosPorGrade[grade]) {
                            produtosPorGrade[grade] = [];
                        }
                        produtosPorGrade[grade].push(produto);
                    });

                mainContent.innerHTML = `<h2>Produtos por Grade</h2>`;

                Object.keys(produtosPorGrade).forEach(grade => {
                    const gradeContainer = document.createElement("div");
                    gradeContainer.className = "grade-section";

                    const storedGrades = window.grade.find(g => g.grade === grade);
                    let baseqtdeProduto = storedGrades ? parseInt(storedGrades.quantidade) || 0 : 0;

                    gradeContainer.innerHTML = `<h3 class="grade-title">${grade} - Desconto de Grade a partir de ${baseqtdeProduto} Peças</h3>`;

                    produtosPorGrade[grade].forEach(produto => {
                        gradeContainer.innerHTML += createProductHTML(produto, "product-container2");
                    });

                    mainContent.appendChild(gradeContainer);
                });

                atualizarCombos();
            }

            

 ////////////////////////////////MENU CATEGORIAS///////////////////
 let razaoSocialSelecionada = ""; // Global: valor atualizado quando o select muda
 
 
 function renderizarProdutosPorordem_menu(filteredProducts, mainContent, menuSelecionado) {
    // Limpa o conteúdo anterior
    mainContent.innerHTML = '';

    if (menuSelecionado === "CARRINHO DE COMPRA") {
    const cliente = window.clientes.find(c => c.cnpj === razaoSocialSelecionada);

    const tituloCarrinho = `<h2 class="titulo-carrinho">Carrinho de Compras</h2>`;
    const blocoCliente = cliente ? criarBlocoDadosCliente(cliente) : "";

    const blocoResumoCarrinho = `
    <div class="resumo-carrinho">
        <div class="linha-superior">
    <div>Total de Peças:<br><span id="resumo-total-pecas">0</span></div>
    <div>Total Bruto:<br><span id="resumo-total-bruto" style="color: red;">R$ 0,00</span></div>
    <div>Promoções:<br><span id="resumo-promocoes" style="color: green;">R$ 0,00</span></div>
    <div>Combos:<br><span id="resumo-combos" style="color: green;">R$ 0,00</span></div>
    <div>Grades:<br><span id="resumo-grades" style="color: green;">R$ 0,00</span></div>
    <div>Total Líquido:<br><span id="resumo-total-liquido" style="color: blue; font-size: 1.3em;">R$ 0,00</span></div>            
        </div>
        <div class="divider"></div>  
        <div class="linha-inferior">
    <div>Forma de Pagto:<br><span id="resumo-formapagto">-</span></div>       
    <div>Prazo de Pagto:<br><span id="resumo-prazo">-</span></div>
    <div>Total de Parcelas:<br><span id="resumo-parcelas">-</span></div>
    <div>CashBack:<br><span id="resumo-cashback">-</span></div>
        </div>
    </div>
`;

    // Limpa tudo antes de adicionar novo conteúdo
    mainContent.innerHTML = '';

    // Cria um contêiner para os botões com layout em linha
    adicionarBotoesExportacao(mainContent);

    // Cria o container do carrinho
    const carrinhoContainer = document.createElement("div");
    carrinhoContainer.className = "carrinho-container";
    carrinhoContainer.innerHTML = `
        ${tituloCarrinho}
        ${blocoCliente}
        ${blocoResumoCarrinho}
    `;

    // Adiciona todo o conteúdo após o botão
    mainContent.appendChild(carrinhoContainer);


    // 👇 Renderiza os produtos
    const groupedByMenu = groupBy(filteredProducts, 'menu');

    for (const categoria in groupedByMenu) {
        const subTitulo = document.createElement('h3');
        subTitulo.textContent = categoria;
        subTitulo.className = "subtitulo-categoria";
        mainContent.appendChild(subTitulo);

        if (categoria === "COMBOS") {
            let row = document.createElement('div');
            row.className = 'product-row-combo';

            groupedByMenu[categoria].forEach((produto, index) => {
                row.innerHTML += createProductHTMLCombo(produto, "product-container-combo");

                if ((index + 1) % 2 === 0 || index === groupedByMenu[categoria].length - 1) {
                    mainContent.appendChild(row);
                    row = document.createElement('div');
                    row.className = 'product-row-combo';
                }
            });
        } else {
            const row = document.createElement('div');
            row.className = 'product-row';

            groupedByMenu[categoria].forEach(produto => {
                row.innerHTML += createProductHTML(produto, "product-container");
            });

            mainContent.appendChild(row);
        }
    }
} else {
    // Agrupamento normal
    const groupedProducts = groupBy(filteredProducts, 'ordem_menu');

    for (const ordem_menu in groupedProducts) {
        const isCombo = groupedProducts[ordem_menu].some(produto => produto.menu === "COMBOS");
        const row = document.createElement('div');
        row.className = isCombo ? 'product-row-combo' : 'product-row';

        groupedProducts[ordem_menu].forEach(produto => {
            if (produto.menu === "COMBOS") {
                row.innerHTML += createProductHTMLCombo(produto, "product-container-combo");
            } else {
                row.innerHTML += createProductHTML(produto, "product-container");
            }
        });

        adicionarBotoesExportacao(mainContent);
        mainContent.appendChild(row);
      
    }
    
}

   atualizarCombos();


 }


        /////INICIANDO CARREGAR CONFIGURACAO DE POLITICAS///
        function carregarConfiguracaoPoliticas() {            
                    
                // Carregar os dados diretamente do arquivo politicas.js
                const politicaValues = window.politicas;
                console.log("🔍 Dados carregados do arquivo politicas.js (Política Comercial):", politicaValues);


                // 🔹 Capturar todas as políticas exclusivas e ordená-las alfabeticamente
                const politicasUnicas = [...new Set(window.produtos.map(p => p.politicas))]
                    .filter(politica => politica.trim() !== "") // Remove políticas vazias
                    .sort(); // Ordena em ordem alfabética

                mainContent.innerHTML += `
        <div class="divider"></div>   
        <div class="config-header">
            <button id="togglePoliticasBtn" class="button toggle-grade">+</button> 
            <h2>Políticas Comerciais</h2>
        </div>
                     <div id="button-containerpol" style="display: none;">
                          <button id="exportBtn">Exportar Politicas.js</button>           
                    </div>
        

        <div class="politica-container">
                
            ${politicasUnicas.map((politica) => `
                <div class="politica-row">
                    <h3>${politica}</h3>
                    <div class="linha">
                        <label>Start 01:</label>
                        <br>  
                        <input type="number" step="1" id="start-${politica}-1" 
                            value="${politicaValues[`start-1-${politica}`] || ''}" placeholder="Valor" />
                        </br>
                    </div>
                    <div class="linha">
                        <label>Start 02:</label>
                        <br>  
                        <input type="number" step="1" id="start-${politica}-2" 
                            value="${politicaValues[`start-2-${politica}`] || ''}" placeholder="Valor" />
                        </br>
                    </div>
                    <div class="linha">
                        <label>Start 03:</label>
                        <br>  
                        <input type="number" step="1" id="start-${politica}-3" 
                            value="${politicaValues[`start-3-${politica}`] || ''}" placeholder="Valor" />
                        </br>
                    </div>
                </div>
            `).join('')}
        </div>
    `;

                // ✅ Adicionar eventos aos botões após inserir o conteúdo no DOM
                setTimeout(() => {

                    const exportBtn = document.getElementById("exportBtn");
                    const toggleBtn = document.getElementById("togglePoliticasBtn");
                    const politicasContainer = document.querySelector(".politica-container");
                    const escondebotao = document.getElementById("button-containerpol");


                    if (!exportBtn) {
                        console.error("❌ ERRO: O botão não foi encontrado!");
                        return;
                    }

                     // 🔹 Toggle de exibição da seção de políticas comerciais
                        toggleBtn.addEventListener("click", function () {
                        if (politicasContainer.style.display === "none") {
                              escondebotao.style.display = "flex";
                              politicasContainer.style.display = "flex";
                              toggleBtn.textContent = "−"; // Mudar para "menos"
                          } else {
                              politicasContainer.style.display = "none";
                              escondebotao.style.display = "none";  
                              toggleBtn.textContent = "+"; // Mudar para "mais"
                          }
                        });

                    // 🔹 Exportar para um arquivo politicas.js com os valores da tela
                    exportBtn.addEventListener("click", function () {
                        // Criar um objeto para armazenar os valores da tela
                        const politicaValues = {};

                        document.querySelectorAll('input[id^="start-"]').forEach(input => {
                            const politica = input.id.split('-')[1];  // Ex: "A", "B", "C", etc.
                            const linha = input.id.split('-')[2];    // Ex: "1", "2", "3"
                            politicaValues[`start-${linha}-${politica}`] = parseFloat(input.value) || '';
                        });

                        // Criar conteúdo do arquivo JS com os dados capturados
                        const jsContent = `export default ${JSON.stringify(politicaValues, null, 2)};`;

                        // Criar e baixar o arquivo
                        const blob = new Blob([jsContent], { type: "application/javascript" });
                        const a = document.createElement("a");
                        a.href = URL.createObjectURL(blob);
                        a.download = "politicas.js";
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                    });

                     // 🔹 Esconder a seção por padrão
                        if (politicasContainer) {
                           politicasContainer.style.display = "none";
                        } else {
                        console.error("❌ ERRO: Elemento 'politica-container' não encontrado!");
                        }

                }, 100);
            }        
            
    /////   ////////////////INICIA CONFIGURAÇÃO DE COMBOS/////    
    function carregarConfiguracaoDeCombos() {
    const mainContent = document.getElementById('mainContent');
    const produtosCombos = window.produtos.filter(produto => produto.menu === "COMBOS");
    const storedCombos = window.comboConfig;

    // Criar HTML da configuração de combos com botão de toggle
    const configHTML = `
        <div class="divider"></div>
        <div class="config-header">
            <button id="toggleCombosBtn" class="button toggle-combo">+</button> 
            <h2>  Configuração de Combos </h2>
        </div>
        <div id="combosContent" style="display: none;">
            <div class="button-container">
                <button id="saveCombosBtn">Salvar Configurações</button>
            </div>

            <div class="combos-container">
                ${produtosCombos.map(produto => `
                    <div class="combo-item">
                        <div class="combo-header">
                            <button class="button toggle-combo" onclick="toggleCombo('${produto.codigo}', this)">+</button> 
                            <span class="combo-nome">${produto.nome}</span>
                        </div>

                        <div id="detalhes-${produto.codigo}" class="combo-detalhes hidden">
                            <div class="combo-itens">
                                <div class="combo-linha header">
                                    <span>Quantidade:</span>
                                    <span>Código:</span>
                                    <span>Produto:</span>
                                </div>
                                <div id="comboItens-${produto.codigo}">
                                    ${renderizarItensDoCombo(produto.codigo, storedCombos[produto.codigo] || [])}
                                </div>
                            </div>
                            <button class="add-item" onclick="adicionarLinhaCombo('${produto.codigo}')">+ Adicionar Item</button>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
    `;

    // Inserir HTML no DOM
    mainContent.innerHTML += configHTML;
 // Esperar o conteúdo ser inserido no DOM antes de adicionar o evento
 setTimeout(() => {
        const toggleButton = document.getElementById('toggleCombosBtn');
        const configContent = document.getElementById('combosContent');
        
    // Adicionar evento ao botão de salvar
    const saveBtnCB = document.getElementById("saveCombosBtn");
    if (saveBtnCB) {
        saveBtnCB.addEventListener("click", salvarConfiguracaoDeCombos);
    } else {
        console.error("❌ ERRO: Botão #saveCombosBtn não encontrado!");
    }

    

        if (toggleButton && configContent) {
            toggleButton.addEventListener('click', function () {
                if (configContent.style.display === "none") {
                    configContent.style.display = "block";
                    this.textContent = "−"; // Ícone de recolher
                } else {
                    configContent.style.display = "none";
                    this.textContent = "+"; // Ícone de expandir
                }
            });
        } else {
            console.error("❌ ERRO: Elementos não encontrados no DOM.");
        }
    }, 100); // Pequeno atraso para garantir que os elementos estejam disponíveis
}

        // 🔹 Renderiza os itens do combo
        function renderizarItensDoCombo(codigo, itens) {
            return itens.map((item, index) => `
        <div class="combo-linha">
            <input type="number" id="quantidade-${codigo}-${index}" placeholder="Qtd" value="${item.quantidade}" 
                oninput="verificarSeAdicionaNovaLinha('${codigo}', ${index})"/>
                
            <input type="text" id="codigoProduto-${codigo}-${index}" placeholder="Código" value="${item.produtoCodigo}" 
                oninput="atualizarNomeProduto(this, '${codigo}', ${index})"/>

     	       <span id="nomeProduto-${codigo}-${index}" class="combo-nome-produto">
   		 ${obterNomeProduto(item.produtoCodigo)}
		</span>

        </div>
    `).join('');
        }


        // ✅ Obtém o nome do produto pelo código (evita armazenar nome no LocalStorage)
        function obterNomeProduto(produtoCodigo) {
            const produtoEncontrado = window.produtos.find(p => p.codigo.toString() === produtoCodigo);
            return produtoEncontrado ? produtoEncontrado.nome : "Código não encontrado";
        }

        // ✅ Adiciona uma nova linha ao combo se a última linha já estiver preenchida
        function verificarSeAdicionaNovaLinha(codigo, index) {
            let qtdInput = document.getElementById(`quantidade-${codigo}-${index}`);
    
            // Impede valores negativos
                if (qtdInput) {
                 qtdInput.value = Math.max(0, qtdInput.value);
                }
            
            const qtd = document.getElementById(`quantidade-${codigo}-${index}`).value.trim();
            const cod = document.getElementById(`codigoProduto-${codigo}-${index}`).value.trim();
           
        }


        // ✅ Adiciona uma nova linha ao combo mantendo o alinhamento correto
        function adicionarLinhaCombo(codigo) {
            const container = document.getElementById(`comboItens-${codigo}`);
            const index = container.children.length;

            // Criando a nova linha
            const novaLinha = document.createElement("div");
            novaLinha.classList.add("combo-linha", "adicionar-item"); // Aplicando nova classe
            novaLinha.id = `linha-${codigo}-${index}`;

            // Criando os inputs e a área do nome do produto
            novaLinha.innerHTML = `
            <input type="number" id="quantidade-${codigo}-${index}" placeholder="Qtd" 
            min="0" value="0" 
            oninput="verificarSeAdicionaNovaLinha('${codigo}', ${index})"/>
        
        <input type="text" id="codigoProduto-${codigo}-${index}" placeholder="Código"
            oninput="atualizarNomeProduto(this, '${codigo}', ${index})"/>
        
        <span id="nomeProduto-${codigo}-${index}" class="combo-nome-produto">Digite o código</span>
    `;

            // Adiciona a linha ao container do combo
            container.appendChild(novaLinha);
        }


        // ✅ Atualiza o nome do produto automaticamente ao digitar o código
        function atualizarNomeProduto(input, codigo, index) {
            const produtoEncontrado = window.produtos.find(p => p.codigo.toString() === input.value.trim());
            const nomeProdutoSpan = document.getElementById(`nomeProduto-${codigo}-${index}`);

            if (produtoEncontrado) {
                nomeProdutoSpan.textContent = produtoEncontrado.nome;
            } else {
                nomeProdutoSpan.textContent = "Código não encontrado";
            }
        }

        // ✅ Exportar dados para arquivo .js
        function salvarConfiguracaoDeCombos() {
    const comboConfig = {};

    document.querySelectorAll('.combo-item').forEach(item => {
        const codigo = item.querySelector('.toggle-combo')?.getAttribute('onclick')?.match(/\d+/)?.[0];

        if (!codigo) {
            console.error("❌ ERRO: Código do combo não encontrado!", item);
            return;
        }

        const linhas = item.querySelectorAll('.combo-linha');
        comboConfig[codigo] = [];

        linhas.forEach((linha, index) => {
            const quantidadeInput = document.getElementById(`quantidade-${codigo}-${index}`);
            const produtoCodigoInput = document.getElementById(`codigoProduto-${codigo}-${index}`);

            if (!quantidadeInput || !produtoCodigoInput) {
                console.warn(`⚠️ Pulando linha inválida para o combo ${codigo}, index ${index}`);
                return;
            }

            const quantidade = quantidadeInput.value.trim();
            const produtoCodigo = produtoCodigoInput.value.trim();

            if (quantidade && produtoCodigo) {
                comboConfig[codigo].push({ quantidade, produtoCodigo });
            }
        });
    });

    // Verifica se há dados para salvar antes de gerar o arquivo
    if (Object.keys(comboConfig).length > 0) {
        const conteudoArquivo = `export default ${JSON.stringify(comboConfig, null, 2)};`;
        
        const blob = new Blob([conteudoArquivo], { type: "application/javascript" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");

        a.href = url;
        a.download = "comboConfig.js";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        alert("✅ Configuração de Combos exportada com sucesso!");
    } else {
        alert("⚠️ Nenhuma configuração válida para exportar.");
    }
}


        // ✅ Alterna a exibição dos detalhes do combo

        function toggleCombo(codigo, button) {
            const detalhesDiv = document.getElementById(`detalhes-${codigo}`);

            if (!detalhesDiv) {
                console.error(`❌ ERRO: Elemento detalhes-${codigo} não encontrado!`);
                return;
            }

            const isHidden = detalhesDiv.classList.toggle('hidden');

            if (isHidden) {
                detalhesDiv.style.maxHeight = "0";
                button.textContent = "+";
            } else {
                detalhesDiv.style.maxHeight = detalhesDiv.scrollHeight + "px"; // 🔥 Expande dinamicamente
                detalhesDiv.style.display = "block"; // 🔥 Garante que fique visível
                button.textContent = "-";
            }

            console.log(`🔄 Toggle Combo ${codigo}: ${isHidden ? "Fechado" : "Aberto"}`);
        }

          /////////////////INICIANDO GRADES///////////////

          function carregarConfiguracaoDeGrades() {
    const mainContent = document.getElementById('mainContent');

    if (!window.grade || !Array.isArray(window.grade)) {
        console.error("window.grade não está carregado corretamente!");
        return;
    }

    // Criar HTML da configuração
    const configHTML = `
        <div class="divider"></div>
        <div class="config-header">            
                <button id="toggleConfigBtn" class="button toggle-grade">+</button>
                <h2> Configuração de Grades </h2>
        </div>
        <div id="configContent" style="display: none;">
            <div class="button-container">
                <button id="saveGradesBtn">Salvar Alterações</button>
                <button id="buscaratualizadoBtn">Buscar Atualizações</button>
            </div>

            <div class="grades-container">
                ${window.grade.map(item => `
                    <div class="grade-item">
                        <button class="button toggle-grade" onclick="toggleGrade('${item.grade}', this)">+</button> 
                        <input type="number" id="grade-${item.grade}" placeholder="Valor" value="${item.quantidade}" />
                        <span class="grade-nome">${item.grade}</span>            	 
                        <div id="produtos-${item.grade}" class="produtos-relacionados hidden">
                            ${item.produtos.map(produto => `<p>${produto}</p>`).join('')}
                        </div>                        
                    </div>
                `).join('')}
            </div>

            <div class="divider"></div>
        </div>
    `;

    // Inserir HTML no DOM
    mainContent.innerHTML += configHTML;

    // Garantir que os produtos comecem escondidos
    document.querySelectorAll(".produtos-relacionados").forEach(div => {
        div.style.display = "none";
    });

    adicionarEventosDeAlteracao();
    document.getElementById('saveGradesBtn').addEventListener('click', gerarGradeJS);
    document.getElementById('buscaratualizadoBtn').addEventListener('click', gerarNovaGradeJS);

    // Agora que os elementos estão no DOM, podemos adicionar o evento ao botão de toggle
    const toggleButton = document.getElementById('toggleConfigBtn');
    const configContent = document.getElementById('configContent');

    toggleButton.addEventListener('click', function () {
        if (configContent.style.display === "none") {
            configContent.style.display = "block";
            this.textContent = "−"; // Ícone de recolher
        } else {
            configContent.style.display = "none";
            this.textContent = "+"; // Ícone de expandir
        }
    });
}


function adicionarEventosDeAlteracao() {
    document.querySelectorAll('.grade-item input').forEach(input => {
        input.addEventListener('input', function () {
            this.classList.add("input-alterado");
            let mensagem = this.parentNode.querySelector(".alteracao-msg");
            if (!mensagem) {
                mensagem = document.createElement("span");
                mensagem.textContent = "Quantidade alterada";
                mensagem.classList.add("alteracao-msg");
                this.parentNode.appendChild(mensagem);
            }
        });
    });
}

function toggleGrade(grade, button) {
    const produtosDiv = document.getElementById(`produtos-${grade}`);
    if (produtosDiv) {
        const isHidden = produtosDiv.classList.toggle('hidden');
        produtosDiv.style.display = isHidden ? "none" : "block";
        button.textContent = isHidden ? "+" : "-";
    } else {
        console.error(`Elemento produtos-${grade} não encontrado!`);
    }
}

function gerarGradeJS() {
    if (!window.grade || !Array.isArray(window.grade)) {
        console.error("window.grade não está definido ou não é um array!");
        return;
    }

    // Atualizar os valores editados na página
    const novasGrades = window.grade.map(item => {
        const input = document.getElementById(`grade-${item.grade}`);
        return {
            grade: item.grade,
            quantidade: input ? parseInt(input.value, 10) || 0 : item.quantidade,
            produtos: item.produtos
        };
    });

    // Criar o conteúdo do arquivo
    const conteudo = `export default ${JSON.stringify(novasGrades, null, 4)};`;

    // Criar Blob e forçar download
    const blob = new Blob([conteudo], { type: "application/javascript" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "grade.js";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

function gerarNovaGradeJS() {
// Criar objeto com grades únicas
const gradesMap = {};

window.produtos.forEach(produto => {
    if (produto.grade && produto.grade.trim() !== "") {
        if (!gradesMap[produto.grade]) {
            gradesMap[produto.grade] = {
                grade: produto.grade,
                quantidade: 0,
                produtos: []
            };
        }
        gradesMap[produto.grade].quantidade++;
        gradesMap[produto.grade].produtos.push(produto.nome);
    }
});

const gradesArray = Object.values(gradesMap);

// Formatar para arquivo JS
const conteudo = `export default ${JSON.stringify(gradesArray, null, 4)};`;

// Criar Blob e forçar download
const blob = new Blob([conteudo], { type: "application/javascript" });
const link = document.createElement("a");
link.href = URL.createObjectURL(blob);
link.download = "grade.js";
document.body.appendChild(link);
link.click();
document.body.removeChild(link);
}
         
  /////////////////////////////////INICIANDO CLIENTES////////


  function carregarConfiguracaoPedidos() {
    const mainContent = document.getElementById('mainContent');
    if (!window.pedidos || window.pedidos.length === 0) {
        mainContent.innerHTML = "<p>Nenhum pedido disponível.</p>";
        return;
    }

    // Criando a estrutura principal
    mainContent.innerHTML = `
        <div class="divider"></div>
          
            <h2>Clientes</h2>
          
          
          <div class="combos-container">
            ${[...new Set(window.pedidos.map(p => p.cidade))].sort().map(cidade => {
                const idCidade = `cidade-${cidade.replace(/\s+/g, '-').toLowerCase()}`;
                return `
                    <div class="combo-item">
                        <div class="combo-header">
                            <button class="button toggle-combo" onclick="toggleSection('${idCidade}', this)">+</button>
                            <span class="combo-nome">${cidade}</span>
                        </div>
                           <div id="${idCidade}" class="clientes-detalhes hidden">
                           <div class="combo-itens">  
                            
                            ${[...new Set(window.pedidos.filter(p => p.cidade === cidade).map(p => p.cnpj))]
                                .sort().map(cnpj => {
                                    const clienteData = window.pedidos.find(p => p.cnpj === cnpj);
                                    const cliente = clienteData?.cliente || "Cliente Desconhecido";
                                    const idCliente = `cliente-${cnpj.replace(/\D/g, '')}`;
                                    return `
                                        <div class="combo-item">
                                            <div class="combo-header">
                                                <button class="button toggle-combo" onclick="toggleSection('${idCliente}', this)">+</button>
                                                <span class="combo-nome">${cliente} - ${cnpj}</span>
                                            </div>
                                            <div id="${idCliente}" class="clientes-detalhes hidden">
                                              <div class="combo-itens">  
                                                 
                                                ${[...new Set(window.pedidos
                                                      .filter(p => p.cnpj === cnpj)
                                                       .sort((a, b) => new Date(b.data) - new Date(a.data))
                                                         .map(p => p.pedido_num) // Mantemos apenas os números de pedido únicos
                                                        )].map(pedido_num => {
                                                      const pedido = window.pedidos.find(p => p.pedido_num === pedido_num); // Pegamos os detalhes completos do pedido
                                                      const idPedido = `pedido-${pedido.pedido_num}`;
                                                  return `
                                                  <div class="combo-item">
                                                    <div class="combo-header">
                                                         <button class="button toggle-combo" onclick="toggleSection('${idPedido}', this)">+</button>
                                                          <span class="combo-nome">
                                                            Pedido: ${pedido.pedido_num} - ${formatarData(pedido.data)} - R$ ${pedido.rodape_subtotal} - ${pedido.prazo} - ${pedido.pagamento} - ${pedido.status_app}
                                                                </span>
                                                    </div>
                                                          <div id="${idPedido}" class="clientes-detalhes hidden">
                                                             <div class="combo-itens">
                                                                <div class="pedidos-linha header">
                <span>Código:</span>
                <span>Produto:</span>
                <span>Unitário:</span>
                <span>Quantidade:</span>
                <span>Subtotal:</span>
            </div>
            ${(() => {
                // Filtra os itens do pedido com base no pedido_num
                const itensDoPedido = window.pedidos.filter(p => p.pedido_num === pedido.pedido_num && p.codigo_pro);

                console.log("Itens do pedido:", itensDoPedido); // Debug

                if (itensDoPedido.length === 0) {
                    return '<p class="sem-itens">Nenhum item neste pedido.</p>';
                }

                return itensDoPedido.map(item => `
                <div class="pedidos-linha header">
                        <span>${formatarNumero(item.codigo_pro)}</span>
                        <span>${item.produto}</span>
                        <span>R$ ${formatarDecimal(item.unitario)}</span>
                        <span>${formatarNumero(item.quantidade)}</span>
                        <span>R$ ${formatarDecimal(item.sub_total)}</span>
                    </div>
                `).join('');
            })()}
        </div>
    </div>
</div>

                                                        `;
                                                    }).join('')}
                                               </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div> 
                        </div>
                    </div>
                `;
            }).join('')}
        </div>
    `;

    
}

// Função para expandir/recolher seções
function toggleSection(id, btn) {
    console.log("Toggling section:", id);
    const section = document.getElementById(id);
    if (section) {
        if (section.classList.contains("hidden")) {
            section.classList.remove("hidden");

            btn.textContent = "−";
        } else {
            section.classList.add("hidden");
            btn.textContent = "+";
        }
    } else {
        console.log("Erro: Seção não encontrada para ID:", id);
    }
}

// Funções de formatação
function formatarNumero(valor) {
    return valor ? parseInt(valor) : "0";
}
function formatarData(data) {
    if (!data) return "Data inválida"; // Caso a data seja undefined ou null

    // Tenta converter automaticamente a data
    let dataObj = new Date(data);

    // Se a conversão padrão falhar, tenta ajustar formatos manuais
    if (isNaN(dataObj)) {
        if (typeof data === "string" && data.includes("/")) {
            let [dia, mes, ano] = data.split("/");
            dataObj = new Date(`${ano}-${mes}-${dia}`); // Ajusta formato brasileiro
        } else if (typeof data === "string" && /^\d{8}$/.test(data)) {
            let ano = data.substring(0, 4);
            let mes = data.substring(4, 6);
            let dia = data.substring(6, 8);
            dataObj = new Date(`${ano}-${mes}-${dia}`);
        }
    }

    return !isNaN(dataObj) 
        ? dataObj.toLocaleDateString("pt-BR") 
        : "Data inválida";
}

function formatarDecimal(valor) {
    return valor ? parseFloat(valor).toFixed(2) : "0.00";
}




//////////////////////////CONTAINERS///////


   ///////////////////////////////////// FUNÇÃO PADRAO PARA CONTAINER CATEGORIAS///////////////////////////////

   function createProductHTML(produto, containerClass) {
            const codigo = produto.codigo;
            const precoOriginal = parseFloat(produto.preco) || 0;
            const promoPercentual = parseFloat(produto["promo_%"]) || 0;
            const precoComDesconto = precoOriginal * (1 - promoPercentual);
            const polia = parseFloat(produto["poli_a_%"]) || 0;
            const polib = parseFloat(produto["poli_b_%"]) || 0;
            const polic = parseFloat(produto["poli_c_%"]) || 0;



            if (!quantities[codigo]) {
                quantities[codigo] = { quantidade: 0, total: 0, desconto: 0, combo: 0, combo1: 0, cashback: 0, gradeDesconto: 0 };
            }

            return `
        <div class="${containerClass}">
            <div class="product-wrapper">
                <div class="wrapper_impress">
                ${promoPercentual > 0
                    ? `<p class="promo-banner">🔥 PROMOÇÃO ${promoPercentual.toFixed(2) * 100}% 🔥</p>`
                    : ""}
               
		     	  <div class="image-container">
   			         <img src="imagens/${produto.imagem}?t=${new Date().getTime()}" 
       	 		   alt="${produto.nome}" 
       			    class="product-image">
			      </div>
                
		          <p>
  		            ${promoPercentual > 0
                    ? `<span class="old-price">De R$ ${precoOriginal.toFixed(2)}</span> 
   		        <br> <span class="discount-price">Por R$ ${precoComDesconto.toFixed(2)}</span>`
                    : `<br><span class="discount-price">Preço: R$ ${precoOriginal.toFixed(2)}</span>`}

		           </p>
                   ${polia > 0 || polib > 0 || polic > 0
                    ? `<div class="desconto-container">
                        ${polia > 0 ? `<div class="retangulo amarelo">${(polia * 100).toFixed(0)}% OFF</div>` : ''}
                        ${polib > 0 ? `<div class="retangulo verde">${(polib * 100).toFixed(0)}% OFF</div>` : ''}
                        ${polic > 0 ? `<div class="retangulo azul">${(polic * 100).toFixed(0)}% OFF</div>` : ''}
                      </div>`
                    : ''}
                 </div>       
    

                   <div class = "wrapper_corte">

                  <div class="control-container">
                    <img src="imagens/controles/menos_raso.jpg" alt="Diminuir" class="control-image" 
                        onmousedown="alterarBotao(this, 'imagens/controles/menos_fundo.jpg')" 
                        onmouseup="alterarBotao(this, 'imagens/controles/menos_raso.jpg'); decrement('${codigo}', ${precoOriginal})">
                    
                    <span class="quantity-display" id="quantity-${codigo}">${quantities[codigo].quantidade}</span>
                    
                    <img src="imagens/controles/mais_raso.jpg" alt="Aumentar" class="control-image" 
                        onmousedown="alterarBotao(this, 'imagens/controles/mais_fundo.jpg')" 
                        onmouseup="alterarBotao(this, 'imagens/controles/mais_raso.jpg'); increment('${codigo}', ${precoOriginal})">
                  </div> 
                <p><b>SubTotal Bruto: R$ <span id="total-${codigo}">${quantities[codigo].total.toFixed(2)}</span> </b></p>
          <p>  
            <br><em><b style="font-size: 16px; color: red;">Descontos:</b></em></br>
               ${parseFloat(produto["poli_a_%"]) > 0 ? `Combo com <span id="combo1-${codigo}"> </span>% = R$ <span id="combo-${codigo}">0.00</span>` : ""}
               ${parseFloat(produto["promo_%"]) > 0 ? `Desconto de ${produto["promo_%"] * 100}% =  R$ <span id="desconto-${codigo}">0.00</span>` : ""}
               ${parseFloat(produto["grade_%"]) > 0 ? `Grade com ${produto["grade_%"] * 100}% = R$ <span id="gradeDesconto-${codigo}">0.00</span>` : ""}       
         </p>  
   
         <p>
             
               <br><em><b style="font-size: 16px; color: red;">Valores Liquidos:</b></em></br>     
                   SubTotal Líquido: R$ <span id="liquido-${codigo}">0.00</span>
               <br>Cada Item: R$ <span id="cadaCombo-${codigo}">0.00</span> 
          </p>    
    
             <div class="divider"></div>
            <p>
              
                 
  		<em> ${parseFloat(produto["cashback_%"]) > 0 ? `CashBack de ${produto["cashback_%"] * 100}% = R$ <span id="cashback-${codigo}">0;00</span>` : ""}</em>
   		 
		</p> 
    </div>
        </div>  
        </div>
        </div>
    `;

        }

 ///////////////////////////////////// FUNÇÃO PADRAO PARA CONTAINER COMBOS///////////////////////////////

        function createProductHTMLCombo(produto, containerClass) {
    const codigo = produto.codigo;
    const precoOriginal = parseFloat(produto.preco) || 0;
    
    if (!quantities[codigo]) {
       quantities[codigo] = { quantidade: 0, total: 0, desconto: 0, combo: 0, combo1: 0, cashback: 0, gradeDesconto: 0, liquido: 0, cadaCombo: 0 };
    }

    // 🔹 Buscar os itens do combo diretamente da variável global window.comboConfig
    const comboItens = window.comboConfig || {};
    const itensDoCombo = comboItens[codigo] || [];

    return `
        <div class="${containerClass}">
            <div class="parent">
            
                <!-- 🔹 Imagem do Produto (Esquerda) -->
                <div class="div1">
                    <div class="image-container-combo">
                        <img src="imagens/${produto.imagem}?t=${new Date().getTime()}" 
                             alt="${produto.nome}" 
                             class="product-image-combo">
                    </div>
                </div>

                <!-- 🔹 Informações do Produto (Direita) -->
                <div class="div2">
                    <div class="product-wrapper-combo">
                        <p>
                            <span class="old-price-combo">De R$ ${precoOriginal.toFixed(2)}</span> 
                            <br> <span class="discount-price-combo">Por: R$ <span id="cadaCombo-${codigo}">0.00</span></span>
                        </p>

                        <div class="control-container">
                            <img src="imagens/controles/menos_raso.jpg" alt="Diminuir" class="control-image" 
                                 onmousedown="alterarBotao(this, 'imagens/controles/menos_fundo.jpg')" 
                                 onmouseup="alterarBotao(this, 'imagens/controles/menos_raso.jpg'); decrement('${codigo}', ${precoOriginal})">
                            
                            <span class="quantity-display" id="quantity-${codigo}">${quantities[codigo].quantidade}</span>
                            
                            <img src="imagens/controles/mais_raso.jpg" alt="Aumentar" class="control-image" 
                                 onmousedown="alterarBotao(this, 'imagens/controles/mais_fundo.jpg')" 
                                 onmouseup="alterarBotao(this, 'imagens/controles/mais_raso.jpg'); increment('${codigo}', ${precoOriginal})">
                        </div> 

                        <p>SubTotal Bruto: R$ <span id="total-${codigo}">${quantities[codigo].total.toFixed(2)}</span> </p>
                        
                        <p>
                            <br><em><b style="font-size: 16px; color: red;">Descontos:</b></em></br>
                            ${parseFloat(produto["poli_a_%"]) > 0 ? `Combo com <span id="combo1-${codigo}"> </span>% = R$ <span id="combo-${codigo}">0.00</span>` : ""}
                            ${parseFloat(produto["promo_%"]) > 0 ? `Desconto de ${produto["promo_%"] * 100}% = R$ <span id="desconto-${codigo}">0.00</span>` : ""}
                            <br>${parseFloat(produto["grade_%"]) > 0 ? `Grade com ${produto["grade_%"] * 100}% = R$ <span id="gradeDesconto-${codigo}">0.00</span>` : ""}       
                        </p>  

                        <p>
                            <br><em><b style="font-size: 16px; color: red;">Valores Líquidos:</b></em></br>
                            SubTotal Líquido: R$ <span id="liquido-${codigo}">0.00</span>
                        </p>

                        <div class="divider"></div>
                        <p>
                            <em>${parseFloat(produto["cashback_%"]) > 0 ? `CashBack de ${produto["cashback_%"] * 100}% = R$ <span id="cashback-${codigo}">0.00</span>` : ""}</em>
                        </p> 
                    </div>
                </div>


<!-- 🔹 Itens do Combo com Preços Atualizados -->
<div class="div3">
    <p id="titulo-combo-${codigo}">
        <em>
            <b style="font-size: 20px; color: red;">
                Itens do combo:
            </b>
        </em>
    </p>
  
    <div class="cabecalho-itemlist-1">
        <span class="combo-itemlist-3">Qtde</span>
        <span class="combo-itemlist-3">Cod</span>
        <span class="combo-itemlist-3">Produto</span>
        <span class="combo-itemlist-3">Tabela</span>
        <span class="combo-itemlist-3">Final</span>
    </div>

    <div id="combo-itens-list-${codigo}" class="combo-itens-list">
        ${
            (comboItens[codigo] || []).length > 0
            ? (comboItens[codigo] || []).map(item => {
                const produtoItem = window.produtos.find(p => p.codigo.toString() === item.produtoCodigo);
                const precoOriginalItem = produtoItem ? parseFloat(produtoItem.preco) || 0 : 0;
                const descontoReal = (quantities[codigo]?.combo1 || 0) / 100;
                const precoDescontado = precoOriginalItem * (1 - descontoReal);
                const precoFinal = precoDescontado > 0 ? precoDescontado : 0.00; // 🔥 Evita valores negativos

                return `
                    <div class="combo-item-menu">
                        <span class="combo-itemlist-1">${item.quantidade}x</span>
                        <span class="combo-itemlist-1">${item.produtoCodigo}</span>
                        <span class="combo-itemlist-2">${produtoItem ? produtoItem.nome : "Produto não encontrado"}</span>
                        <span class="combo-itemlist-1">R$ ${precoOriginalItem.toFixed(2)}</span>
                        <span class="combo-itemlist-1">R$ ${precoFinal.toFixed(2)}</span>
                    </div>
                `;
            }).join('')
            : '<p>Nenhum item encontrado para este combo.</p>'
        }
    </div>
</div>

    </div>
</div>
    `;
}


    ///////////////////////////////FUNÇÃO PADRAO PARA CONTAINER CARRINHO DE COMPRAS/////////////////////

    function renderizarCarrinho(mainContent) {
                mainContent.innerHTML = `<h2>Carrinho de Compras</h2>`;
                let produtosNoCarrinho = window.produtos.filter(produto => quantities[produto.codigo]?.quantidade > 0);

                if (produtosNoCarrinho.length === 0) {
                    mainContent.innerHTML += `<p>Seu carrinho está vazio.</p>`;
                    return;
                }

                // 🔥 Agrupar produtos por menu
                let produtosPorMenu = {};
                produtosNoCarrinho.forEach(produto => {
                    const categoria = produto.menu || "Outros"; // Se não tiver menu, coloca em "Outros"
                    if (!produtosPorMenu[categoria]) {
                        produtosPorMenu[categoria] = [];
                    }
                    produtosPorMenu[categoria].push(produto);
                });




                // 🔥 Renderizar os produtos agrupados por menu
                Object.keys(produtosPorMenu).forEach(menu => {
                    const gradeContainer = document.createElement("div");
                    gradeContainer.className = "grade-section";

                    gradeContainer.innerHTML = `<h3 class="menu-divider">${menu}</h3>`;

                    produtosPorMenu[menu].forEach(produto => {
                        gradeContainer.innerHTML += createProductHTML(produto, "product-container2");
                    });
                    mainContent.appendChild(gradeContainer);
                });


                atualizarCombos();

            }




///////////FUNCOES DIVERSAS///

function alterarBotao(botao, icones) {
            botao.src = icones;
        }



        function increment(codigo, preco) {
            if (!quantities[codigo]) {
                quantities[codigo] = { quantidade: 0, total: 0, desconto: 0, combo: 0, grade: null, cashback: 0 }; // Garantir que o desconto esteja presente
            }

            quantities[codigo].quantidade++;  // Aumenta a quantidade

            //calcular SubTotal
            quantities[codigo].total = quantities[codigo].quantidade * preco;




            // calcular desconto 
            const produto = window.produtos.find(p => p.codigo.toString() === codigo);
            let descontoPercentual = produto ? produto["promo_%"] : 0;
            if (typeof descontoPercentual === "string") {
                descontoPercentual = parseFloat(descontoPercentual.replace("%", "").replace(",", "."));
            }
            quantities[codigo].desconto = quantities[codigo].quantidade * preco * descontoPercentual;

            // calcular cashback 
            let descontoCashback = produto ? produto["cashback_%"] : 0;
            if (typeof descontoCashback === "string") {
                descontoCashback = parseFloat(descontoCashback.replace("%", "").replace(",", "."));
            }
            quantities[codigo].cashback = quantities[codigo].quantidade * preco * descontoCashback;






            //////////////////////////////// Calcular grade/////////////////////////////////////

            // Reservar a grade do produto e armazená-la
            let gradedoProduto = produto.grade || null;
            quantities[codigo].grade = gradedoProduto;  // 🔹 Agora a grade é armazenada corretamente
            console.log("Grade do Produto:", gradedoProduto);

            // Reservar o valor de desconto da grade
            //let descontoGrade = produto ? produto["grade_%"] : 0;
            //if (typeof descontoGrade === "string") {
            //    descontoGrade = parseFloat(descontoGrade.replace("%", "").replace(",", "."));
            //}
            //console.log("Desconto da Grade (%):", descontoGrade);

            // Somar todas as quantidades de produtos com a mesma grade
            let somaGradeProdutosComprados = Object.values(quantities)
                .filter(q => q.grade === gradedoProduto && q.quantidade > 0) // 🔹 Agora irá encontrar a grade corretamente
                .reduce((acc, q) => acc + q.quantidade, 0);

            console.log(`📊 Soma Total de Produtos na Grade "${gradedoProduto}":`, somaGradeProdutosComprados);

            // Obter a quantidade mínima configurada para essa grade no localStorage
            const storedGrades = window.grade.find(g => g.grade === gradedoProduto);
            let baseqtdeProduto = storedGrades ? parseInt(storedGrades.quantidade) || 0 : 0;
            console.log("Quantidade Mínima Configurada:", baseqtdeProduto);

            // Aplicar o desconto se a soma da grade for maior ou igual à quantidade mínima
            if (somaGradeProdutosComprados >= baseqtdeProduto) {
                console.log(`✅ Desconto aplicado para a grade: ${gradedoProduto}`);

                // 🔄 Aplicar o desconto correto a todos os produtos da mesma grade
                Object.keys(quantities).forEach(outroCodigo => {
                    const produtoAtual = window.produtos.find(p => p.codigo.toString() === outroCodigo);

                    if (produtoAtual && produtoAtual.grade === gradedoProduto) {
                        let descontoGradeAtual = parseFloat(produtoAtual["grade_%"]) || 0;

                        // 🔢 Aplicar a fórmula correta para cada produto
                        quantities[outroCodigo].gradeDesconto =
                            quantities[outroCodigo].quantidade * produtoAtual.preco * descontoGradeAtual;


                        console.log(`✅ Produto ${outroCodigo}: Desconto atualizado para ${quantities[outroCodigo].gradeDesconto}`);


                    }
                });

            } else {
                // ❌ Se não atingiu a quantidade mínima, zera o desconto para todos os produtos da mesma grade
                console.log(`❌ Desconto removido para a grade: ${gradedoProduto}`);

                Object.keys(quantities).forEach(outroCodigo => {
                    if (quantities[outroCodigo].grade === gradedoProduto) {
                        quantities[outroCodigo].gradeDesconto = 0;
                        console.log(`❌ Produto ${outroCodigo}: Desconto zerado`);
                    }
                });
            }



            console.log(`increment_qtde : ${quantities[codigo].quantidade}`);
            console.log(`increment_total : ${quantities[codigo].total}`);
            console.log(`increment_descontos %: ${quantities[codigo].desconto}`);
            console.log(`increment_combo %: ${quantities[codigo].combo}`);
            console.log(`increment_cashback %: ${quantities[codigo].cashback}`);
            console.log(`increment_combo 1: ${quantities[codigo].combo1}`);
            console.log(`increment_Grade : ${quantities[codigo].grade}`);
            console.log(`🔄 Atualizando interface para o código: ${codigo}`);
            console.log("Quantidade Atualizada:", quantities[codigo].quantidade);
            console.log("Total Atualizado:", quantities[codigo].total);
            console.log("Elemento encontrado?", document.getElementById(`quantity-${codigo}`));
            //console.log("increment_Desconto da Grade (%):", descontoGrade);



            //////////////////////////////////////calcular grade////////////////////





            atualizarCombos(); // Recalcula os descontos de TODOS os produtos após cada incremento
            atualizarQuantidade(codigo);



        }



        function decrement(codigo, preco) {
            if (quantities[codigo] && quantities[codigo].quantidade > 0) {
                quantities[codigo].quantidade--;

                // Atualiza o total
                quantities[codigo].total = quantities[codigo].quantidade * preco;

                // 🔹 Recalcular o desconto corretamente ao diminuir a quantidade
                const produto = window.produtos.find(p => p.codigo.toString() === codigo);
                let descontoPercentual = produto ? produto["promo_%"] : 0;

                if (typeof descontoPercentual === "string") {
                    descontoPercentual = parseFloat(descontoPercentual.replace("%", "").replace(",", "."));
                }

                // 🔥 Corrigindo o cálculo do desconto
                quantities[codigo].desconto = quantities[codigo].quantidade * preco * (descontoPercentual);

                // calcular cashback 
                let descontoCashback = produto ? produto["cashback_%"] : 0;
                if (typeof descontoCashback === "string") {
                    descontoCashback = parseFloat(descontoCashback.replace("%", "").replace(",", "."));
                }
                quantities[codigo].cashback = quantities[codigo].quantidade * preco * descontoCashback;

                //////////////////////////////// Calcular grade/////////////////////////////////////

                // Reservar a grade do produto e armazená-la
                let gradedoProduto = produto.grade || null;
                quantities[codigo].grade = gradedoProduto;  // 🔹 Agora a grade é armazenada corretamente
                console.log("Grade do Produto:", gradedoProduto);

                // Reservar o valor de desconto da grade
                //let descontoGrade = produto ? produto["grade_%"] : 0;
                //if (typeof descontoGrade === "string") {
                //    descontoGrade = parseFloat(descontoGrade.replace("%", "").replace(",", "."));
                //}
                //console.log("Desconto da Grade (%):", descontoGrade);

                // Somar todas as quantidades de produtos com a mesma grade
                let somaGradeProdutosComprados = Object.values(quantities)
                    .filter(q => q.grade === gradedoProduto && q.quantidade > 0) // 🔹 Agora irá encontrar a grade corretamente
                    .reduce((acc, q) => acc + q.quantidade, 0);

                console.log(`📊 Soma Total de Produtos na Grade "${gradedoProduto}":`, somaGradeProdutosComprados);

                // Obter a quantidade mínima configurada para essa grade no localStorage
                const storedGrades = window.grade.find(g => g.grade === gradedoProduto);
                let baseqtdeProduto = storedGrades ? parseInt(storedGrades.quantidade) || 0 : 0;
                console.log("Quantidade Mínima Configurada:", baseqtdeProduto);

                // Aplicar o desconto se a soma da grade for maior ou igual à quantidade mínima
                if (somaGradeProdutosComprados >= baseqtdeProduto) {
                    console.log(`✅ Desconto aplicado para a grade: ${gradedoProduto}`);

                    // 🔄 Aplicar o desconto correto a todos os produtos da mesma grade
                    Object.keys(quantities).forEach(outroCodigo => {
                        const produtoAtual = window.produtos.find(p => p.codigo.toString() === outroCodigo);

                        if (produtoAtual && produtoAtual.grade === gradedoProduto) {
                            let descontoGradeAtual = parseFloat(produtoAtual["grade_%"]) || 0;

                            // 🔢 Aplicar a fórmula correta para cada produto
                            quantities[outroCodigo].gradeDesconto =
                                quantities[outroCodigo].quantidade * produtoAtual.preco * descontoGradeAtual;

                            console.log(`✅ Produto ${outroCodigo}: Desconto atualizado para ${quantities[outroCodigo].gradeDesconto}`);
                        }
                    });

                } else {
                    // ❌ Se não atingiu a quantidade mínima, zera o desconto para todos os produtos da mesma grade
                    console.log(`❌ Desconto removido para a grade: ${gradedoProduto}`);

                    Object.keys(quantities).forEach(outroCodigo => {
                        if (quantities[outroCodigo].grade === gradedoProduto) {
                            quantities[outroCodigo].gradeDesconto = 0;
                            console.log(`❌ Produto ${outroCodigo}: Desconto zerado`);
                        }
                    });
                }



                console.log(`increment_qtde : ${quantities[codigo].quantidade}`);
                console.log(`increment_total : ${quantities[codigo].total}`);
                console.log(`increment_descontos %: ${quantities[codigo].desconto}`);
                console.log(`increment_combo %: ${quantities[codigo].combo}`);
                console.log(`increment_cashback %: ${quantities[codigo].cashback}`);
                console.log(`increment_combo 1: ${quantities[codigo].combo1}`);
                console.log(`increment_Grade : ${quantities[codigo].grade}`);
                //console.log("increment_Desconto da Grade (%):", descontoGrade);



                //////////////////////////////////////calcular grade////////////////////




                // Atualizar os combos e os valores na tela
                atualizarCombos();
                atualizarQuantidade(codigo);

            }
        }








        function atualizarCombos() {
            // Carregar os dados diretamente do arquivo politicas.js
            const politicaValues = window.politicas;

            // Calcular o total bruto
            let totalBruto = Object.values(quantities)
                .filter(item => item.quantidade > 0) // 🔥 Apenas produtos com quantidade > 0
                .reduce((acc, item) => acc + item.total, 0);

            console.log(`\n===== ATUALIZANDO ITENS PEDIDOS =====`);
            console.log(`Total Bruto Atualizado: ${totalBruto}`);

            Object.keys(quantities)
                .filter(codigo => quantities[codigo].quantidade > 0) // 🔥 Filtra apenas produtos ativos
                .forEach(codigo => {
                    const produto = window.produtos.find(p => p.codigo.toString() === codigo);
                    if (!produto) return;  // Verifica se o produto existe

                    // 🔹 Determinar a política comercial do produto diretamente pelo valor encontrado
                    let politica = produto["politicas"]?.trim() || "SEM_POLITICA";

                    if (politica === "SEM_POLITICA") {
                        console.warn(`⚠️ Produto ${produto.nome} (Código: ${produto.codigo}) não possui política definida.`);
                        politica = "SEM_POLITICA";
                    }

                    console.log(`📌 Produto: ${produto.nome}, Código: ${produto.codigo}, Política Aplicada: ${politica}`);

                    let descontoPercentualCombo = 0;

                    // 🔹 Aplicar os descontos apenas se houver uma política válida
                    if (politica !== "SEM_POLITICA") {
                        let start1 = parseFloat(politicaValues[`start-1-${politica}`]) || 0;
                        let start2 = parseFloat(politicaValues[`start-2-${politica}`]) || 0;
                        let start3 = parseFloat(politicaValues[`start-3-${politica}`]) || 0;

                        if (totalBruto >= start1 && totalBruto < start2) {
                            descontoPercentualCombo = parseFloat(produto["poli_a_%"]) || 0;
                        } else if (totalBruto >= start2 && totalBruto < start3) {
                            descontoPercentualCombo = parseFloat(produto["poli_b_%"]) || 0;
                        } else if (totalBruto >= start3) {
                            descontoPercentualCombo = parseFloat(produto["poli_c_%"]) || 0;
                        }
                    }

                    // 🔹 Aplicar os valores calculados no produto
                    if (politica !== "SEM_POLITICA") {
                        quantities[codigo].combo = quantities[codigo].quantidade * produto.preco * descontoPercentualCombo;
                        quantities[codigo].combo1 = descontoPercentualCombo * 100;
                    } else {
                        quantities[codigo].combo = 0.00;
                        quantities[codigo].combo1 = 0.00;
                    }

                    // 🔹 Log para depuração
                    console.log(`✅ Produto ${codigo} atualizado:`);
                    console.log(`Quantidade: ${quantities[codigo].quantidade}`);
                    console.log(`Desconto Aplicado: ${descontoPercentualCombo * 100}%`);
                    console.log(`Total Combo: R$ ${quantities[codigo].combo.toFixed(2)}`);

                    // 🔹 Atualizar a quantidade para refletir os cálculos
                    atualizarQuantidade(codigo);
                });

            console.log(`===== FIM DA ATUALIZAÇÃO COMBOS =====\n`);

            atualizarTotais();
        }



        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


        function atualizarQuantidade(codigo) {
            const produto = window.produtos.find(p => p.codigo.toString() === codigo);
            const gradedoProduto = produto ? produto.grade : null;

            if (!gradedoProduto) {
                // Se não tem grade, atualizar apenas o produto específico
                atualizarProdutoSemGrade(codigo);
                return;
            }

            console.log("📌 Atualizando gradeDesconto para todos os produtos com grade:", gradedoProduto);

            Object.keys(quantities).forEach(cod => {
                if (quantities[cod].grade === gradedoProduto) {
                    const quantidade = quantities[cod]?.quantidade || 0;
                    const total = quantities[cod]?.total || 0;
                    const desconto = quantities[cod]?.desconto || 0;
                    const combo = quantities[cod]?.combo || 0;
                    const cashback = quantities[cod]?.cashback || 0;
                    const combo1 = quantities[cod]?.combo1 || 0;
                    const gradeDesconto = quantities[cod]?.gradeDesconto || 0;
                    const liquido = total - desconto - combo - gradeDesconto;
                    const cadaCombo = liquido / quantidade || 0;

                    const liqui_coef = total !== 0 ? liquido / total : 0; // Evita divisão por zero
                    quantities[codigo].liqui_coef = liqui_coef; // Armazena no objeto para uso posterior




                    console.log(`atualiza_qtde : ${quantities[codigo].quantidade}`);
                    console.log(`atualiza_total : ${quantities[codigo].total}`);
                    console.log(`atualiza_descontos %: ${quantities[codigo].desconto}`);
                    console.log(`atualiza_combo %: ${quantities[codigo].combo}`);
                    console.log(`atualiza_cashback %: ${quantities[codigo].cashback}`);
                    console.log(`atualiza_combo 1: ${quantities[codigo].combo1}`);
                    console.log(`atualiza_Grade : ${quantities[codigo].gradeDesconto}`);
                    console.log(`atualiza_GradeDesconto : ${quantities[codigo].gradeDesconto}`);
                    console.log(`atualiza_Liquido : ${total - desconto - combo - gradeDesconto}`);
                    console.log(`atualiza_CadaCombo : ${(total - desconto - combo - gradeDesconto) / quantidade || 0}`);


                    atualizarItensDoCombo(codigo);



                    const quantidadeEl = document.getElementById(`quantity-${cod}`);
                    const totalEl = document.getElementById(`total-${cod}`);
                    const descontoEl = document.getElementById(`desconto-${cod}`);
                    const comboEl = document.getElementById(`combo-${cod}`);
                    const cashbackEl = document.getElementById(`cashback-${cod}`);
                    const combo1El = document.getElementById(`combo1-${cod}`);
                    const gradeDescontoEl = document.getElementById(`gradeDesconto-${cod}`);
                    const liquidoEl = document.getElementById(`liquido-${cod}`);
                    const cadaComboEl = document.getElementById(`cadaCombo-${cod}`);



                    if (quantidadeEl) quantidadeEl.textContent = quantidade;
                    if (totalEl) totalEl.textContent = total.toFixed(2);
                    if (descontoEl) descontoEl.textContent = desconto.toFixed(2);
                    if (comboEl) comboEl.textContent = combo.toFixed(2);
                    if (cashbackEl) cashbackEl.textContent = cashback.toFixed(2);
                    if (combo1El) combo1El.textContent = combo1.toFixed(0);
                    if (gradeDescontoEl) gradeDescontoEl.textContent = gradeDesconto.toFixed(2);
                    if (liquidoEl) liquidoEl.textContent = liquido.toFixed(2);
                    if (cadaComboEl) cadaComboEl.textContent = cadaCombo.toFixed(2);

                    // 🔥 Se a quantidade for 0, zerar os valores na tela
                    if (quantidade === 0) {
                        if (totalEl) totalEl.textContent = "0.00";
                        if (descontoEl) descontoEl.textContent = "0.00";
                        if (comboEl) comboEl.textContent = "0.00";
                        if (cashbackEl) cashbackEl.textContent = "0.00";
                        if (combo1El) combo1El.textContent = "0.00";
                        if (gradeDescontoEl) gradeDescontoEl.textContent = "0.00";
                        if (liquidoEl) liquidoEl.textContent = "0.00";
                        if (cadaComboEl) cadaComboEl.textContent = "0.00";


                    }


                }



            });




            function atualizarProdutoSemGrade(codigo) {

                const quantidade = quantities[codigo]?.quantidade || 0;
                const total = quantities[codigo]?.total || 0;
                const desconto = quantities[codigo]?.desconto || 0;
                const combo = quantities[codigo]?.combo || 0;
                const cashback = quantities[codigo]?.cashback || 0;
                const combo1 = quantities[codigo]?.combo1 || 0;
                const gradeDesconto = quantities[codigo]?.gradeDesconto || 0;
                const liquido = total - desconto - combo - gradeDesconto;
                const cadaCombo = liquido / quantidade || 0;

                const liqui_coef = total !== 0 ? liquido / total : 0; // Evita divisão por zero
                quantities[codigo].liqui_coef = liqui_coef; // Armazena no objeto para uso posterior





                console.log(`sg_atualiza_qtde : ${quantities[codigo].quantidade}`);
                console.log(`atualiza_total : ${quantities[codigo].total}`);
                console.log(`atualiza_descontos %: ${quantities[codigo].desconto}`);
                console.log(`atualiza_combo %: ${quantities[codigo].combo}`);
                console.log(`atualiza_cashback %: ${quantities[codigo].cashback}`);
                console.log(`atualiza_combo 1: ${quantities[codigo].combo1}`);

                console.log(`atualiza_GradeDesconto : ${quantities[codigo].gradeDesconto}`);
                console.log(`atualiza_Liquido : ${total - desconto - combo - gradeDesconto}`);
                console.log(`atualiza_CadaCombo : ${(total - desconto - combo - gradeDesconto) / quantidade || 0}`);



                atualizarItensDoCombo(codigo);




                // Buscar os elementos no DOM
                const quantidadeEl = document.getElementById(`quantity-${codigo}`);
                const totalEl = document.getElementById(`total-${codigo}`);
                const descontoEl = document.getElementById(`desconto-${codigo}`);
                const comboEl = document.getElementById(`combo-${codigo}`);
                const cashbackEl = document.getElementById(`cashback-${codigo}`);
                const combo1El = document.getElementById(`combo1-${codigo}`);
                const gradeDescontoEl = document.getElementById(`gradeDesconto-${codigo}`);
                const liquidoEl = document.getElementById(`liquido-${codigo}`);
                const cadaComboEl = document.getElementById(`cadaCombo-${codigo}`);

                // Atualizar valores na interface
                if (quantidadeEl) quantidadeEl.textContent = quantidade;
                if (totalEl) totalEl.textContent = total.toFixed(2);
                if (descontoEl) descontoEl.textContent = desconto.toFixed(2);
                if (comboEl) comboEl.textContent = combo.toFixed(2);
                if (cashbackEl) cashbackEl.textContent = cashback.toFixed(2);
                if (combo1El) combo1El.textContent = combo1.toFixed(0);
                if (gradeDescontoEl) gradeDescontoEl.textContent = gradeDesconto.toFixed(2);
                if (liquidoEl) liquidoEl.textContent = liquido.toFixed(2);
                if (cadaComboEl) cadaComboEl.textContent = cadaCombo.toFixed(2);

                // 🔥 Se a quantidade for 0, zerar os valores na tela
                if (quantidade === 0) {
                    if (totalEl) totalEl.textContent = "0.00";
                    if (descontoEl) descontoEl.textContent = "0.00";
                    if (comboEl) comboEl.textContent = "0.00";
                    if (cashbackEl) cashbackEl.textContent = "0.00";
                    if (combo1El) combo1El.textContent = "0.00";
                    if (gradeDescontoEl) gradeDescontoEl.textContent = "0.00";
                    if (liquidoEl) liquidoEl.textContent = "0.00";
                    if (cadaComboEl) cadaComboEl.textContent = "0.00";
                }


            }
            atualizarTotais();
        }


        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        function atualizarItensDoCombo(codigo) {
            console.log(`🔄 Atualizando itens do combo ${codigo}...`);

            // Buscar o container correto para este combo
            const comboItensContainer = document.getElementById(`combo-itens-list-${codigo}`);
            if (!comboItensContainer) {
                console.warn(`⚠️ Container de itens do combo não encontrado para ${codigo}`);
                return;
            }

            // Obtém os itens do LocalStorage
            const itensDoCombo = window.comboConfig?.[codigo] || [];

            comboItensContainer.innerHTML = ""; // Limpa antes de atualizar


            // 🔹 Atualiza dinamicamente o título dos itens do combo

            const tituloCombo = document.querySelector(`#titulo-combo-${codigo}`);
            const coefi = ((1 - quantities[codigo]?.liqui_coef || 0) * 100).toFixed(0);
            console.log(`nonono ${coefi}`);


            if (tituloCombo) {
                tituloCombo.innerHTML = `
       
        <em>
            <b style="font-size: 20px; color: red;">
                ${(quantities[codigo]?.quantidade || 0) > 0
                        ? `Itens do combo com ${coefi}% de desconto:`
                        : "Itens do combo:"}
            </b>
        </em>
        `;
            }




            // Verifica a quantidade do combo
            const quantidadeCombo = quantities[codigo]?.quantidade || 0;

            itensDoCombo.forEach(item => {
                const produtoItem = window.produtos.find(p => p.codigo.toString() === item.produtoCodigo);
                const precoOriginalItem = produtoItem ? parseFloat(produtoItem.preco) || 0 : 0;




                let precoFinal;

                if (quantidadeCombo === 0) {
                    // Se a quantidade do combo for 0, o preço do item volta ao original
                    precoFinal = precoOriginalItem;
                } else {
                    // Caso contrário, aplica o desconto do combo normalmente

                    const coeficiente = quantities[codigo]?.liqui_coef || 0;
                    precoFinal = precoOriginalItem * coeficiente;


                }

                const itemHTML = `
            <div class="combo-item-menu">
                <span class="combo-itemlist-1">${item.quantidade}x</span>
                <span class="combo-itemlist-1">${item.produtoCodigo}</span>
                <span class="combo-itemlist-2">${produtoItem ? produtoItem.nome : "Produto não encontrado"}</span>
                <span class="combo-itemlist-1">R$ ${precoOriginalItem.toFixed(2)}</span>  
                <span class="combo-itemlist-1">R$ ${precoFinal.toFixed(2)}</span>
            </div>
        `;

                comboItensContainer.innerHTML += itemHTML; // Adiciona os itens atualizados
            });
        }


        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        let totalLiquidoOriginal = 0; // Variável global para armazenar o valor original

function atualizarTotais() {
    let totalPecas = 0;
    let totalBruto = 0;
    let totalDesconto = 0;
    let totalCombos = 0;
    let totalCashback = 0;
    let totalGradeDesconto = 0;

    Object.keys(quantities)
        .filter(codigo => quantities[codigo].quantidade > 0)
        .forEach(codigo => {
            totalPecas += quantities[codigo].quantidade;
            totalBruto += quantities[codigo].total;
            totalDesconto += quantities[codigo].desconto || 0;
            totalCombos += quantities[codigo].combo || 0;
            totalCashback += quantities[codigo].cashback || 0;
            totalGradeDesconto += quantities[codigo].gradeDesconto || 0;
        });

    totalLiquidoOriginal = totalBruto - totalDesconto - totalCombos - totalGradeDesconto;

    function formatarMoeda(valor) {
        return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    // 🔹 Atualiza valores na tela
    document.getElementById('totalPecas').value = totalPecas;
    document.getElementById('totalBruto').value = formatarMoeda(totalBruto);
    document.getElementById('totalDesconto').value = formatarMoeda(totalDesconto);
    document.getElementById('totalCombos').value = formatarMoeda(totalCombos);
    document.getElementById('totalCashback').value = formatarMoeda(totalCashback);
    document.getElementById('totalGradeDesconto').value = formatarMoeda(totalGradeDesconto);
    document.getElementById('totalLiquido').value = formatarMoeda(totalLiquidoOriginal);

    // 🔹 Atualiza os prazos de pagamento
    atualizarOpcoesPagamento(totalBruto);
}

function atualizarOpcoesPagamento(totalBruto) {
    const selectPrazoPagto = document.getElementById("prazoPagto");
    const totalParcelasInput = document.getElementById("totalparcelas");
    const prazoSalvo = sessionStorage.getItem("prazoPagamento");

    if (!window.prazos || !Array.isArray(window.prazos)) {
        console.error("A variável global 'window.prazos' não está definida corretamente.");
        return;
    }

    let prazosDisponiveis = window.prazos
        .filter(prazo => totalBruto >= prazo.bruto)
        .sort((a, b) => a.bruto - b.bruto);

    selectPrazoPagto.innerHTML = prazosDisponiveis.length > 0
        ? `<option value="">Selecione um Prazo</option>` + prazosDisponiveis.map(p => 
            `<option value="${p.prazo}" data-parcelas="${p.parcelas}" data-desconto="${p.desconto}">
                ${p.prazo}
            </option>`).join('')
        : `<option value="">Nenhuma opção disponível</option>`;

    // 🔹 Verifica se o prazo salvo ainda é válido
    let prazoAindaValido = prazosDisponiveis.some(p => p.prazo === prazoSalvo);

    if (prazoSalvo && prazoAindaValido) {
        selectPrazoPagto.value = prazoSalvo;
    } else {
        // 🔹 Se o prazo salvo não for válido, remove do sessionStorage e ZERA Total de Parcelas
        sessionStorage.removeItem("prazoPagamento");
        sessionStorage.removeItem("parcelasPagamento");
        sessionStorage.removeItem("descontoPagamento");

        totalParcelasInput.value = ""; // Zera o campo Total de Parcelas
    }

    selectPrazoPagto.innerHTML = prazosDisponiveis.length > 0
        ? `<option value="">Selecione um Prazo</option>` +
          prazosDisponiveis.map(p => 
              `<option value="${p.prazo}" 
                       data-parcelas="${p.parcelas || ''}" 
                       data-desconto="${p.desconto || 0}" 
                       ${prazoSalvo === p.prazo ? "selected" : ""}>
                  ${p.prazo}
              </option>`
          ).join('')
        : `<option value="">Nenhuma opção disponível</option>`;

    // 🔹 Aplica o desconto e parcelas sempre que os prazos forem recalculados
    aplicarDescontoPagamento();
    atualizarResumoCarrinho();
}

function aplicarDescontoPagamento() {
    const selectPrazoPagto = document.getElementById("prazoPagto");
    const opcaoSelecionada = selectPrazoPagto.options[selectPrazoPagto.selectedIndex];

    if (!opcaoSelecionada || !opcaoSelecionada.value) {
        console.warn("Nenhuma opção válida selecionada.");
        return;
    }

    let descontoStr = opcaoSelecionada.getAttribute("data-desconto");
    let desconto = descontoStr ? parseFloat(descontoStr) : 1;
    desconto = desconto === 0 ? 1 : desconto;

    let parcelas = parseInt(opcaoSelecionada.getAttribute("data-parcelas")) || 1;

    let novoTotal = totalLiquidoOriginal * desconto;
    let valorParcela = novoTotal / parcelas;

    document.getElementById("totalLiquido").value = novoTotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

    const totalParcelasInput = document.getElementById("totalparcelas");
    totalParcelasInput.value = `${parcelas} x ${valorParcela.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`;

    // 🔹 Armazena o prazo, parcelas e desconto
    sessionStorage.setItem("prazoPagamento", selectPrazoPagto.value);
    sessionStorage.setItem("parcelasPagamento", parcelas);
    sessionStorage.setItem("descontoPagamento", desconto);
    atualizarResumoCarrinho();
}

// 🔹 Eventos ao carregar a página
document.addEventListener("DOMContentLoaded", () => {
    const selectPrazoPagto = document.getElementById("prazoPagto");

    selectPrazoPagto.addEventListener("change", aplicarDescontoPagamento);

    // 🔹 Restaurar prazo salvo ao iniciar
    let prazoSalvo = sessionStorage.getItem("prazoPagamento");
    if (prazoSalvo) {
        selectPrazoPagto.value = prazoSalvo;
        aplicarDescontoPagamento();
    }
});



function atualizarResumoCarrinho() {
    if (!document.getElementById("resumo-total-pecas")) return; // ainda não exibido 
    document.getElementById("resumo-total-pecas").textContent = document.getElementById("totalPecas")?.value || "-";
    document.getElementById("resumo-total-bruto").textContent = document.getElementById("totalBruto")?.value || "-";
    document.getElementById("resumo-promocoes").textContent = document.getElementById("totalDesconto")?.value || "-";
    document.getElementById("resumo-combos").textContent = document.getElementById("totalCombos")?.value || "-";
    document.getElementById("resumo-grades").textContent = document.getElementById("totalGradeDesconto")?.value || "-";
    document.getElementById("resumo-total-liquido").textContent = document.getElementById("totalLiquido")?.value || "-";
    document.getElementById("resumo-cashback").textContent = document.getElementById("totalCashback")?.value || "-";
    document.getElementById("resumo-formapagto").textContent = document.getElementById("formapagto")?.value || "-";
    document.getElementById("resumo-prazo").textContent = document.getElementById("prazoPagto")?.value || "-";
    document.getElementById("resumo-parcelas").textContent = document.getElementById("totalparcelas")?.value || "-";
    
}



document.addEventListener("DOMContentLoaded", () => {
  const selectFormaPagto = document.getElementById("formapagto");

  if (selectFormaPagto) {
    selectFormaPagto.addEventListener("change", () => {
      console.log("💳 Forma de pagamento alterada:", selectFormaPagto.value);
      atualizarResumoCarrinho();
    });
  }
});



function groupBy(array, key) {
    return array.reduce((result, currentValue) => {
        (result[currentValue[key]] = result[currentValue[key]] || []).push(currentValue);
        return result;
    }, {});
}


document.addEventListener("DOMContentLoaded", function () {
    console.log("📢 Script carregado corretamente!");

    let pressTimer;

    // Delegação de evento: captura eventos em qualquer .product-image que aparecer
    document.addEventListener("pointerdown", function (event) {
       if (event.target.classList.contains("product-image") || event.target.classList.contains("product-image-combo")) {

            console.log("⏳ Segurando na imagem...");
            pressTimer = setTimeout(() => {
                console.log("🔍 Abrindo modal...");
                openModal(event.target.src);
            }, 250); // determina o tempo do presstimer
        }
    });

    document.addEventListener("pointerup", function () {
        console.log("🛑 Soltou a imagem!");
        clearTimeout(pressTimer);
    });

    document.addEventListener("pointerleave", function () {
        clearTimeout(pressTimer);
    });

    // Função para abrir o modal com a imagem ampliada
    function openModal(imageSrc) {
        console.log("🔄 Abrindo modal com imagem:", imageSrc);
        const modal = document.getElementById("imageModal");
        const modalImage = document.getElementById("modalImage");

        if (modal && modalImage) {
            modalImage.src = imageSrc;
            modal.style.display = "flex";
        } else {
            console.error("❌ ERRO: Elementos do modal não encontrados!");
        }
    }

    // Função para fechar o modal ao clicar no "X"
    function closeModal() {
        console.log("❌ Fechando modal!");
        const modal = document.getElementById("imageModal");
        if (modal) {
            modal.style.display = "none";
        }
    }

    // ✅ Evento para fechar APENAS ao clicar no "X"
    document.getElementById("closeModalBtn").addEventListener("click", function () {
        closeModal();
    });
});




    </script>



  //  <div id="imageModal" class="modal" style="display: none;">
  //     <span id="closeModalBtn" class="close">&times;</span>
  //        <img id="modalImage" class="modal-content">
  //  </div>

</body>

</html>


</body>

</html>